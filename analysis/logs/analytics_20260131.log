2026-01-31 08:31:33,459 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:31:33,484 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:31:33,511 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:31:33,535 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:31:42,126 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 08:31:42,273 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:31:44,250 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:31:44,254 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:31:45,888 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:31:45,891 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:31:48,003 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:31:48,006 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:31:49,573 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:31:52,689 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 08:31:52,689 - analysis.lead_bookings_extractor - INFO - Conversation length: 1357 chars
2026-01-31 08:31:52,691 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:31:55,720 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:32:10,806 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:32:10,830 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:32:10,853 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:32:10,873 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:32:12,416 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 08:32:12,530 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:32:14,355 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:33:31,701 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:33:31,723 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:33:31,746 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:33:31,770 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:33:33,273 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 08:33:33,383 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:33:35,394 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:33:35,396 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:33:36,779 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:33:36,780 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:33:38,908 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:33:38,913 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:33:40,137 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:33:40,138 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:33:42,616 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:33:42,618 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:33:44,143 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:33:44,293 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 08:33:44,293 - analysis.lead_bookings_extractor - INFO - Conversation length: 1357 chars
2026-01-31 08:33:44,296 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:33:45,404 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:34:37,151 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:34:37,173 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:34:37,199 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:34:37,225 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:34:38,705 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 08:34:38,816 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:34:40,786 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:34:40,790 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:34:42,734 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:34:42,736 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:34:44,852 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:34:44,856 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:34:47,463 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:34:47,465 - analysis.gemini_client - ERROR - Gemini structured generation error: Expecting ',' delimiter: line 6 column 88 (char 281)
2026-01-31 08:34:47,465 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:34:50,370 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:34:50,372 - analysis.gemini_client - ERROR - Gemini structured generation error: Unterminated string starting at: line 20 column 25 (char 444)
2026-01-31 08:34:50,372 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:34:53,180 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:34:53,182 - analysis.gemini_client - ERROR - Gemini structured generation error: Expecting property name enclosed in double quotes: line 9 column 1 (char 124)
2026-01-31 08:34:53,184 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:34:54,818 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:34:54,820 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:34:56,208 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:35:34,913 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:35:34,935 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:35:34,963 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:35:34,985 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:35:36,605 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 08:35:36,712 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:35:38,339 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:35:38,342 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:35:41,261 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:35:41,261 - analysis.gemini_client - ERROR - Gemini structured generation error: Expecting property name enclosed in double quotes: line 7 column 3 (char 91)
2026-01-31 08:35:41,263 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:35:43,971 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:35:43,972 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:35:46,940 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:35:46,942 - analysis.gemini_client - ERROR - Gemini structured generation error: Expecting property name enclosed in double quotes: line 17 column 1 (char 338)
2026-01-31 08:35:46,943 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:35:48,988 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:35:49,069 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 08:35:49,069 - analysis.lead_bookings_extractor - INFO - Conversation length: 1357 chars
2026-01-31 08:35:49,073 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:35:50,422 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:39:07,976 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:39:08,000 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:39:08,025 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:39:08,049 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:39:09,586 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 08:39:09,779 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:39:11,129 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:39:11,131 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:39:13,280 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:39:13,285 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:39:16,353 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:39:16,356 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 15 column 26 (char 312)
2026-01-31 08:39:16,356 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
  "first_name": "",
  "full_name": "",
  "email": "",
  "phone": "",
  "whatsapp": "",
  "position": "",
  "company": "",
  "available_time": "Tomorrow at 6:00 PM GST",
  "contact_preference": "Call",
  "location": "",
  "education_level": "",
  "school_name": "",
  "curriculum": "",
  "academic_performance":
2026-01-31 08:39:16,358 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_083916.txt
2026-01-31 08:39:16,358 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:39:19,320 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:39:19,323 - analysis.gemini_client - ERROR - JSON decode error: Unterminated string starting at: line 2 column 17 (char 18)
2026-01-31 08:39:19,323 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
  "first_name": "
2026-01-31 08:39:19,326 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_083919.txt
2026-01-31 08:39:19,326 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:39:22,188 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:39:22,191 - analysis.gemini_client - ERROR - JSON decode error: Unterminated string starting at: line 13 column 3 (char 254)
2026-01-31 08:39:22,191 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
  "first_name": "",
  "full_name": "",
  "email": "",
  "phone": "",
  "whatsapp": "",
  "position": "",
  "company": "",
  "available_time": "tomorrow at 6:00 PM GST",
  "contact_preference": "Phone call",
  "location": "",
  "education_level": "",
  "school_
2026-01-31 08:39:22,193 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_083922.txt
2026-01-31 08:39:22,195 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:39:23,826 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:39:23,903 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 08:39:23,903 - analysis.lead_bookings_extractor - INFO - Conversation length: 1357 chars
2026-01-31 08:39:23,905 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:39:25,330 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:41:47,252 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:41:47,273 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:41:47,299 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:41:47,322 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:41:48,865 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 08:41:48,972 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:41:50,978 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:41:50,982 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:41:54,146 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:41:54,151 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:41:55,429 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:41:55,511 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 08:41:55,511 - analysis.lead_bookings_extractor - INFO - Conversation length: 1357 chars
2026-01-31 08:41:55,513 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:41:58,655 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:47:27,023 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:47:27,046 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:47:27,070 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:47:27,094 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:47:28,663 - analysis.merged_analytics - INFO - Analyzing call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e...
2026-01-31 08:47:28,663 - analysis.merged_analytics - INFO - Processing call - Word count: 196, Duration: 60s, Text length: 1155 chars
2026-01-31 08:47:28,663 - analysis.merged_analytics - INFO - Step 1/7: Analyzing sentiment...
2026-01-31 08:47:28,663 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 08:47:28,773 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:47:30,848 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:47:30,851 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 1 column 1 (char 0)
2026-01-31 08:47:30,851 - analysis.gemini_client - ERROR - Raw response that failed to parse:
Here is the JSON
2026-01-31 08:47:30,852 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_084730.txt
2026-01-31 08:47:30,853 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:47:32,281 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:47:32,282 - analysis.merged_analytics - INFO - Step 2/7: Generating summary...
2026-01-31 08:47:32,283 - analysis.merged_analytics - INFO - Starting summary generation...
2026-01-31 08:47:32,283 - analysis.merged_analytics - ERROR - Summary generation error: 'CallAnalytics' object has no attribute '_call_gemini_api'
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\analysis\merged_analytics.py", line 1871, in generate_summary
    summary_text = self._call_gemini_api(prompt, temperature=0.3, max_output_tokens=800)
                   ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'CallAnalytics' object has no attribute '_call_gemini_api'. Did you mean: '_call_gemini_text'?
2026-01-31 08:47:32,285 - analysis.merged_analytics - INFO - Step 3/7: Determining lead disposition...
2026-01-31 08:47:32,285 - analysis.merged_analytics - ERROR - LLM disposition error: 'CallAnalytics' object has no attribute '_call_gemini_api', using fallback
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\analysis\merged_analytics.py", line 1468, in _determine_lead_disposition_llm
    llm_response = self._call_gemini_api(prompt, temperature=0.1, max_output_tokens=150)
                   ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'CallAnalytics' object has no attribute '_call_gemini_api'. Did you mean: '_call_gemini_text'?
2026-01-31 08:47:32,288 - analysis.merged_analytics - INFO - Lead disposition: FOLLOW UP IN 3 DAYS - Action: Send info, follow up in 2-3 days
2026-01-31 08:47:32,288 - analysis.merged_analytics - INFO - Step 4/7: Calculating lead score from disposition...
2026-01-31 08:47:32,288 - analysis.merged_analytics - INFO - Lead score: 8.0/10 - Category: warm Lead
2026-01-31 08:47:32,288 - analysis.merged_analytics - INFO - Step 5/7: Calculating quality metrics...
2026-01-31 08:47:32,289 - analysis.merged_analytics - INFO - Step 6/7: Extracting call stages...
2026-01-31 08:47:32,289 - analysis.merged_analytics - INFO - Step 7/7: Extracting lead information...
2026-01-31 08:47:32,290 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:47:34,225 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:47:34,229 - analysis.lead_info_extractor - INFO - Lead info extracted: 5 fields
2026-01-31 08:47:34,230 - analysis.lead_info_extractor - INFO - Lead info saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_bc7815e3_20260131_084734.json
2026-01-31 08:47:34,230 - analysis.merged_analytics - INFO - Lead info extracted: 5 fields, saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_bc7815e3_20260131_084734.json
2026-01-31 08:47:34,231 - analysis.merged_analytics - INFO - LLM cost for this call: $0.000000 (0 tokens)
2026-01-31 08:47:34,231 - analysis.merged_analytics - INFO - Call analysis complete - Call ID: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, Lead Score: 8.0/10, Disposition: FOLLOW UP IN 3 DAYS
2026-01-31 08:47:35,011 - analysis.merged_analytics - INFO - Updated tags column in leads table (lead_id: 15edc307-a954-4674-8be9-5b8876df9c11, tags: ['warm Lead'])
2026-01-31 08:47:35,011 - analysis.merged_analytics - INFO - Analytics saved to database (call_log_id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e)
2026-01-31 08:47:35,776 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 08:47:35,991 - utils.vertical_routing - INFO - Vertical routing: tenant_id=734cd516-e252-4728-9c52-4663ee552653, vertical=general
2026-01-31 08:47:39,244 - utils.vertical_routing - WARNING - Failed to parse JSON from general extraction response
2026-01-31 08:47:40,685 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 08:47:40,685 - analysis.lead_bookings_extractor - INFO - Conversation length: 1186 chars
2026-01-31 08:47:40,688 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:47:42,316 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:47:42,319 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:47:43,852 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:47:43,854 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 1 column 1 (char 0)
2026-01-31 08:47:43,854 - analysis.gemini_client - ERROR - Raw response that failed to parse:
Here is the JSON
2026-01-31 08:47:43,856 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_084743.txt
2026-01-31 08:47:43,856 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:47:45,285 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:53:18,143 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:53:18,166 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:53:18,189 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:53:18,211 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:53:19,796 - analysis.merged_analytics - INFO - Analyzing call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e...
2026-01-31 08:53:19,796 - analysis.merged_analytics - INFO - Processing call - Word count: 196, Duration: 60s, Text length: 1155 chars
2026-01-31 08:53:19,796 - analysis.merged_analytics - INFO - Step 1/7: Analyzing sentiment...
2026-01-31 08:53:19,798 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 08:53:19,906 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:53:21,878 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:53:21,879 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 1 column 1 (char 0)
2026-01-31 08:53:21,880 - analysis.gemini_client - ERROR - Raw response that failed to parse:
Here is the JSON
2026-01-31 08:53:21,880 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_085321.txt
2026-01-31 08:53:21,881 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:53:23,414 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:53:23,417 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:53:26,505 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:53:26,506 - analysis.merged_analytics - INFO - Step 2/7: Generating summary...
2026-01-31 08:53:26,506 - analysis.merged_analytics - INFO - Starting summary generation...
2026-01-31 08:53:26,506 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:53:34,166 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:53:34,168 - analysis.merged_analytics - INFO - Summary generation complete - Key points: 5, Questions: 0
2026-01-31 08:53:34,168 - analysis.merged_analytics - INFO - Step 3/7: Determining lead disposition...
2026-01-31 08:53:34,168 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:53:37,342 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:53:37,343 - analysis.merged_analytics - INFO - Lead disposition: FOLLOW UP IN 3 DAYS - Action: Execute the scheduled follow-up call tomorrow at 6:0
2026-01-31 08:53:37,343 - analysis.merged_analytics - INFO - Step 4/7: Calculating lead score from disposition...
2026-01-31 08:53:37,343 - analysis.merged_analytics - INFO - Lead score: 8.0/10 - Category: warm Lead
2026-01-31 08:53:37,343 - analysis.merged_analytics - INFO - Step 5/7: Calculating quality metrics...
2026-01-31 08:53:37,343 - analysis.merged_analytics - INFO - Step 6/7: Extracting call stages...
2026-01-31 08:53:37,345 - analysis.merged_analytics - INFO - Step 7/7: Extracting lead information...
2026-01-31 08:53:37,345 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:53:40,105 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:53:40,106 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:53:43,178 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:53:43,180 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 2 column 16 (char 17)
2026-01-31 08:53:43,180 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
  "first_name":
2026-01-31 08:53:43,182 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_085343.txt
2026-01-31 08:53:43,182 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:53:45,737 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:53:45,739 - analysis.lead_info_extractor - INFO - Lead info extracted: 6 fields
2026-01-31 08:53:45,739 - analysis.lead_info_extractor - INFO - Lead info saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_bc7815e3_20260131_085345.json
2026-01-31 08:53:45,739 - analysis.merged_analytics - INFO - Lead info extracted: 6 fields, saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_bc7815e3_20260131_085345.json
2026-01-31 08:53:45,739 - analysis.merged_analytics - INFO - LLM cost for this call: $0.000000 (0 tokens)
2026-01-31 08:53:45,741 - analysis.merged_analytics - INFO - Call analysis complete - Call ID: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, Lead Score: 8.0/10, Disposition: FOLLOW UP IN 3 DAYS
2026-01-31 08:53:46,546 - analysis.merged_analytics - INFO - Updated tags column in leads table (lead_id: 15edc307-a954-4674-8be9-5b8876df9c11, tags: ['warm Lead'])
2026-01-31 08:53:46,546 - analysis.merged_analytics - INFO - Analytics saved to database (call_log_id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e)
2026-01-31 08:53:47,271 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 08:53:47,467 - utils.vertical_routing - INFO - Vertical routing: tenant_id=734cd516-e252-4728-9c52-4663ee552653, vertical=general
2026-01-31 08:53:51,062 - utils.vertical_routing - ERROR - General vertical routing failed for call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e: 'parts'
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\utils\vertical_routing.py", line 440, in _route_general_vertical
    raw_text = response_data["candidates"][0]["content"]["parts"][0]["text"].strip()
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
KeyError: 'parts'
2026-01-31 08:53:52,670 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 08:53:52,670 - analysis.lead_bookings_extractor - INFO - Conversation length: 1186 chars
2026-01-31 08:53:52,672 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:53:56,387 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:53:56,390 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:53:58,004 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:53:58,005 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 1 column 1 (char 0)
2026-01-31 08:53:58,005 - analysis.gemini_client - ERROR - Raw response that failed to parse:
Here is the
2026-01-31 08:53:58,005 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_085358.txt
2026-01-31 08:53:58,005 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:53:59,465 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:56:39,634 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:56:39,655 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:56:39,681 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 08:56:39,703 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 08:56:41,303 - analysis.merged_analytics - INFO - Analyzing call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e...
2026-01-31 08:56:41,304 - analysis.merged_analytics - INFO - Processing call - Word count: 196, Duration: 60s, Text length: 1155 chars
2026-01-31 08:56:41,304 - analysis.merged_analytics - INFO - Step 1/7: Analyzing sentiment...
2026-01-31 08:56:41,304 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 08:56:41,420 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:56:43,299 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:56:43,323 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:56:46,576 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:56:46,582 - analysis.merged_analytics - INFO - Step 2/7: Generating summary...
2026-01-31 08:56:46,582 - analysis.merged_analytics - INFO - Starting summary generation...
2026-01-31 08:56:46,583 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:56:53,871 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:56:53,873 - analysis.merged_analytics - INFO - Summary generation complete - Key points: 4, Questions: 1
2026-01-31 08:56:53,873 - analysis.merged_analytics - INFO - Step 3/7: Determining lead disposition...
2026-01-31 08:56:53,873 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:56:57,003 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:56:57,004 - analysis.merged_analytics - WARNING - No result from text generation
2026-01-31 08:56:57,005 - analysis.merged_analytics - WARNING - LLM disposition failed, using fallback
2026-01-31 08:56:57,005 - analysis.merged_analytics - INFO - Lead disposition: FOLLOW UP IN 3 DAYS - Action: Send info, follow up in 2-3 days
2026-01-31 08:56:57,006 - analysis.merged_analytics - INFO - Step 4/7: Calculating lead score from disposition...
2026-01-31 08:56:57,006 - analysis.merged_analytics - INFO - Lead score: 8.0/10 - Category: warm Lead
2026-01-31 08:56:57,006 - analysis.merged_analytics - INFO - Step 5/7: Calculating quality metrics...
2026-01-31 08:56:57,006 - analysis.merged_analytics - INFO - Step 6/7: Extracting call stages...
2026-01-31 08:56:57,006 - analysis.merged_analytics - INFO - Step 7/7: Extracting lead information...
2026-01-31 08:56:57,006 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:57:00,193 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:57:00,196 - analysis.gemini_client - ERROR - JSON decode error: Unterminated string starting at: line 2 column 3 (char 4)
2026-01-31 08:57:00,196 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
  "first_name
2026-01-31 08:57:00,196 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_085700.txt
2026-01-31 08:57:00,199 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:57:03,114 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:57:03,116 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 2 column 16 (char 17)
2026-01-31 08:57:03,116 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
  "first_name":
2026-01-31 08:57:03,117 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_085703.txt
2026-01-31 08:57:03,119 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:57:06,441 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:57:06,444 - analysis.lead_info_extractor - WARNING - No result from structured generation
2026-01-31 08:57:06,444 - analysis.lead_info_extractor - WARNING - LLM did not return lead information
2026-01-31 08:57:06,444 - analysis.merged_analytics - INFO - LLM cost for this call: $0.000000 (0 tokens)
2026-01-31 08:57:06,444 - analysis.merged_analytics - INFO - Call analysis complete - Call ID: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, Lead Score: 8.0/10, Disposition: FOLLOW UP IN 3 DAYS
2026-01-31 08:57:07,273 - analysis.merged_analytics - INFO - Updated tags column in leads table (lead_id: 15edc307-a954-4674-8be9-5b8876df9c11, tags: ['warm Lead'])
2026-01-31 08:57:07,273 - analysis.merged_analytics - INFO - Analytics saved to database (call_log_id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e)
2026-01-31 08:57:08,083 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 08:57:08,326 - utils.vertical_routing - INFO - Vertical routing: tenant_id=734cd516-e252-4728-9c52-4663ee552653, vertical=general
2026-01-31 08:57:08,326 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 08:57:08,388 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:57:14,020 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:57:14,458 - utils.vertical_routing - INFO - General vertical: Updated lead_extraction for call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e with 4 fields
2026-01-31 08:57:14,460 - post_call_analysis.runner - INFO - Vertical routing: call_log_id=bc7815e3-04da-4a6c-84c3-0ef6f2165f1e routed to lad_dev.voice_call_analysis (vertical=general)
2026-01-31 08:57:15,967 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 08:57:15,967 - analysis.lead_bookings_extractor - INFO - Conversation length: 1186 chars
2026-01-31 08:57:15,969 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:57:17,809 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:57:17,813 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:57:19,241 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:57:19,244 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 1 column 1 (char 0)
2026-01-31 08:57:19,244 - analysis.gemini_client - ERROR - Raw response that failed to parse:
Here is the JSON requested
2026-01-31 08:57:19,246 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_085719.txt
2026-01-31 08:57:19,247 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:57:20,573 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:57:20,578 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 1 column 1 (char 0)
2026-01-31 08:57:20,578 - analysis.gemini_client - ERROR - Raw response that failed to parse:
Here is the JSON
2026-01-31 08:57:20,582 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_085720.txt
2026-01-31 08:57:20,583 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 08:57:22,006 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 08:57:22,010 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 1 column 1 (char 0)
2026-01-31 08:57:22,010 - analysis.gemini_client - ERROR - Raw response that failed to parse:
Here is the
2026-01-31 08:57:22,012 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_085722.txt
2026-01-31 08:57:22,013 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:00:16,134 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:00:16,155 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:00:16,179 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:00:16,201 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:00:17,718 - analysis.merged_analytics - INFO - Analyzing call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e...
2026-01-31 09:00:17,718 - analysis.merged_analytics - INFO - Processing call - Word count: 196, Duration: 60s, Text length: 1155 chars
2026-01-31 09:00:17,718 - analysis.merged_analytics - INFO - Step 1/7: Analyzing sentiment...
2026-01-31 09:00:17,719 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:00:17,826 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:00:19,879 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-001:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:00:19,883 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:00:21,005 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-001:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:00:21,005 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:00:22,541 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-001:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:00:22,544 - analysis.merged_analytics - INFO - Step 2/7: Generating summary...
2026-01-31 09:00:22,544 - analysis.merged_analytics - INFO - Starting summary generation...
2026-01-31 09:00:22,545 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:00:26,233 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-001:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:00:26,235 - analysis.merged_analytics - INFO - Summary generation complete - Key points: 3, Questions: 0
2026-01-31 09:00:26,235 - analysis.merged_analytics - INFO - Step 3/7: Determining lead disposition...
2026-01-31 09:00:26,235 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:00:27,461 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-001:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:00:27,463 - analysis.merged_analytics - INFO - Lead disposition: FOLLOW UP IN 3 DAYS - Action: Follow up with the prospect in 1 day at 6:00 PM GST as agreed upon.
2026-01-31 09:00:27,463 - analysis.merged_analytics - INFO - Step 4/7: Calculating lead score from disposition...
2026-01-31 09:00:27,463 - analysis.merged_analytics - INFO - Lead score: 8.0/10 - Category: warm Lead
2026-01-31 09:00:27,464 - analysis.merged_analytics - INFO - Step 5/7: Calculating quality metrics...
2026-01-31 09:00:27,464 - analysis.merged_analytics - INFO - Step 6/7: Extracting call stages...
2026-01-31 09:00:27,465 - analysis.merged_analytics - INFO - Step 7/7: Extracting lead information...
2026-01-31 09:00:27,465 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:00:29,508 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-001:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:00:29,510 - analysis.lead_info_extractor - INFO - Lead info extracted: 3 fields
2026-01-31 09:00:29,511 - analysis.lead_info_extractor - INFO - Lead info saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_bc7815e3_20260131_090029.json
2026-01-31 09:00:29,511 - analysis.merged_analytics - INFO - Lead info extracted: 3 fields, saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_bc7815e3_20260131_090029.json
2026-01-31 09:00:29,511 - analysis.merged_analytics - INFO - LLM cost for this call: $0.000000 (0 tokens)
2026-01-31 09:00:29,512 - analysis.merged_analytics - INFO - Call analysis complete - Call ID: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, Lead Score: 8.0/10, Disposition: FOLLOW UP IN 3 DAYS
2026-01-31 09:00:30,301 - analysis.merged_analytics - INFO - Updated tags column in leads table (lead_id: 15edc307-a954-4674-8be9-5b8876df9c11, tags: ['warm Lead'])
2026-01-31 09:00:30,301 - analysis.merged_analytics - INFO - Analytics saved to database (call_log_id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e)
2026-01-31 09:00:31,106 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 09:00:31,324 - utils.vertical_routing - INFO - Vertical routing: tenant_id=734cd516-e252-4728-9c52-4663ee552653, vertical=general
2026-01-31 09:00:31,325 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:00:31,384 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:00:36,866 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:00:37,304 - utils.vertical_routing - INFO - General vertical: Updated lead_extraction for call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e with 6 fields
2026-01-31 09:00:37,304 - post_call_analysis.runner - INFO - Vertical routing: call_log_id=bc7815e3-04da-4a6c-84c3-0ef6f2165f1e routed to lad_dev.voice_call_analysis (vertical=general)
2026-01-31 09:00:38,867 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 09:00:38,867 - analysis.lead_bookings_extractor - INFO - Conversation length: 1186 chars
2026-01-31 09:00:38,869 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:00:40,460 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-001:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:00:40,466 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:00:41,792 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-001:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:08:34,325 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:08:34,354 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:08:34,378 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:08:34,400 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:08:41,299 - analysis.merged_analytics - INFO - Analyzing call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e...
2026-01-31 09:08:41,299 - analysis.merged_analytics - INFO - Processing call - Word count: 196, Duration: 60s, Text length: 1155 chars
2026-01-31 09:08:41,299 - analysis.merged_analytics - INFO - Step 1/7: Analyzing sentiment...
2026-01-31 09:08:41,299 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:08:41,420 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:08:43,590 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:08:43,592 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:08:44,919 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:08:44,922 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the
2026-01-31 09:08:44,924 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:08:46,355 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:08:46,356 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is
2026-01-31 09:08:46,356 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:08:47,861 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:08:47,863 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:08:47,863 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:08:49,221 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:08:49,223 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:08:49,223 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:08:50,553 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:08:50,555 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:08:51,985 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:08:51,988 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:08:53,420 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:08:53,423 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here
2026-01-31 09:08:53,423 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:08:54,749 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:08:54,754 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:08:56,288 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:08:56,288 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:08:56,289 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:08:59,227 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:08:59,228 - analysis.merged_analytics - INFO - Step 2/7: Generating summary...
2026-01-31 09:08:59,228 - analysis.merged_analytics - INFO - Starting summary generation...
2026-01-31 09:08:59,229 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:06,630 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:06,631 - analysis.merged_analytics - INFO - Summary generation complete - Key points: 4, Questions: 0
2026-01-31 09:09:06,631 - analysis.merged_analytics - INFO - Step 3/7: Determining lead disposition...
2026-01-31 09:09:06,632 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:09,805 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:09,806 - analysis.merged_analytics - WARNING - No result from text generation
2026-01-31 09:09:09,806 - analysis.merged_analytics - WARNING - LLM disposition failed, using fallback
2026-01-31 09:09:09,806 - analysis.merged_analytics - INFO - Lead disposition: FOLLOW UP IN 3 DAYS - Action: Send info, follow up in 2-3 days
2026-01-31 09:09:09,806 - analysis.merged_analytics - INFO - Step 4/7: Calculating lead score from disposition...
2026-01-31 09:09:09,806 - analysis.merged_analytics - INFO - Lead score: 8.0/10 - Category: warm Lead
2026-01-31 09:09:09,806 - analysis.merged_analytics - INFO - Step 5/7: Calculating quality metrics...
2026-01-31 09:09:09,806 - analysis.merged_analytics - INFO - Step 6/7: Extracting call stages...
2026-01-31 09:09:09,808 - analysis.merged_analytics - INFO - Step 7/7: Extracting lead information...
2026-01-31 09:09:09,808 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:12,773 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:12,776 - analysis.gemini_client - ERROR - JSON decode error: Unterminated string starting at: line 2 column 3 (char 4)
2026-01-31 09:09:12,778 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
  "first_
2026-01-31 09:09:12,779 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_090912.txt
2026-01-31 09:09:12,780 - analysis.gemini_client - ERROR - JSON recovery also failed: Unterminated string starting at: line 2 column 3 (char 4)
2026-01-31 09:09:12,780 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:15,875 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:15,878 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:18,918 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:18,919 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:21,785 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:21,788 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:24,858 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:24,861 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 2 column 16 (char 17)
2026-01-31 09:09:24,861 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
  "first_name":
2026-01-31 09:09:24,861 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_090924.txt
2026-01-31 09:09:24,863 - analysis.gemini_client - ERROR - JSON recovery also failed: Expecting value: line 2 column 16 (char 17)
2026-01-31 09:09:24,863 - analysis.lead_info_extractor - WARNING - No result from structured generation
2026-01-31 09:09:24,863 - analysis.lead_info_extractor - WARNING - LLM did not return lead information
2026-01-31 09:09:24,863 - analysis.merged_analytics - INFO - LLM cost for this call: $0.000000 (0 tokens)
2026-01-31 09:09:24,864 - analysis.merged_analytics - INFO - Call analysis complete - Call ID: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, Lead Score: 8.0/10, Disposition: FOLLOW UP IN 3 DAYS
2026-01-31 09:09:25,689 - analysis.merged_analytics - INFO - Updated tags column in leads table (lead_id: 15edc307-a954-4674-8be9-5b8876df9c11, tags: ['warm Lead'])
2026-01-31 09:09:25,689 - analysis.merged_analytics - INFO - Analytics saved to database (call_log_id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e)
2026-01-31 09:09:26,483 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 09:09:26,691 - utils.vertical_routing - INFO - Vertical routing: tenant_id=734cd516-e252-4728-9c52-4663ee552653, vertical=general
2026-01-31 09:09:26,692 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:09:26,758 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:32,258 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:32,702 - utils.vertical_routing - INFO - General vertical: Updated lead_extraction for call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e with 5 fields
2026-01-31 09:09:32,704 - post_call_analysis.runner - INFO - Vertical routing: call_log_id=bc7815e3-04da-4a6c-84c3-0ef6f2165f1e routed to lad_dev.voice_call_analysis (vertical=general)
2026-01-31 09:09:37,695 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 09:09:37,695 - analysis.lead_bookings_extractor - INFO - Conversation length: 1186 chars
2026-01-31 09:09:37,697 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:41,139 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:41,143 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:42,470 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:42,473 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:43,904 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:43,906 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:45,235 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:45,237 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON
2026-01-31 09:09:45,237 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:46,670 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:46,672 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON
2026-01-31 09:09:46,673 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:09:48,103 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:09:48,103 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:10:50,726 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:10:50,753 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:10:50,846 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:10:50,885 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:10:52,369 - analysis.merged_analytics - INFO - Analyzing call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e...
2026-01-31 09:10:52,369 - analysis.merged_analytics - INFO - Processing call - Word count: 196, Duration: 60s, Text length: 1155 chars
2026-01-31 09:10:52,369 - analysis.merged_analytics - INFO - Step 1/7: Analyzing sentiment...
2026-01-31 09:10:52,370 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:10:52,478 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:10:54,561 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:10:54,563 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:10:54,563 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:10:56,213 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:10:56,215 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:10:56,216 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:10:57,492 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:10:57,493 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:10:57,493 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:10:58,964 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:10:58,966 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:11:00,368 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:11:00,369 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:11:00,370 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:11:01,368 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:11:01,369 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:11:02,809 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:11:02,811 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:11:04,101 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:11:04,102 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:11:05,415 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:11:05,418 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the
2026-01-31 09:11:05,419 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:11:06,952 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:11:06,954 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:11:06,955 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:11:10,126 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:11:10,128 - analysis.merged_analytics - WARNING - No result from text generation
2026-01-31 09:11:10,128 - analysis.merged_analytics - INFO - Step 2/7: Generating summary...
2026-01-31 09:11:10,128 - analysis.merged_analytics - INFO - Starting summary generation...
2026-01-31 09:11:10,130 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:11:16,987 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:11:16,991 - analysis.merged_analytics - INFO - Summary generation complete - Key points: 4, Questions: 0
2026-01-31 09:11:16,991 - analysis.merged_analytics - INFO - Step 3/7: Determining lead disposition...
2026-01-31 09:11:16,993 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:11:20,161 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:11:20,163 - analysis.merged_analytics - WARNING - No result from text generation
2026-01-31 09:11:20,164 - analysis.merged_analytics - WARNING - LLM disposition failed, using fallback
2026-01-31 09:11:20,164 - analysis.merged_analytics - INFO - Lead disposition: FOLLOW UP IN 3 DAYS - Action: Send info, follow up in 2-3 days
2026-01-31 09:11:20,164 - analysis.merged_analytics - INFO - Step 4/7: Calculating lead score from disposition...
2026-01-31 09:11:20,164 - analysis.merged_analytics - INFO - Lead score: 8.0/10 - Category: warm Lead
2026-01-31 09:11:20,164 - analysis.merged_analytics - INFO - Step 5/7: Calculating quality metrics...
2026-01-31 09:11:20,165 - analysis.merged_analytics - INFO - Step 6/7: Extracting call stages...
2026-01-31 09:11:20,165 - analysis.merged_analytics - INFO - Step 7/7: Extracting lead information...
2026-01-31 09:11:20,166 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:11:23,539 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:11:23,543 - analysis.gemini_client - ERROR - JSON decode error: Unterminated string starting at: line 2 column 3 (char 4)
2026-01-31 09:11:23,543 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
  "first_
2026-01-31 09:11:23,544 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_091123.txt
2026-01-31 09:11:23,544 - analysis.gemini_client - ERROR - JSON recovery also failed: Unterminated string starting at: line 2 column 3 (char 4)
2026-01-31 09:11:23,544 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:11:26,749 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:11:26,752 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 2 column 16 (char 17)
2026-01-31 09:11:26,752 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
  "first_name":
2026-01-31 09:11:26,753 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_091126.txt
2026-01-31 09:11:26,754 - analysis.gemini_client - ERROR - JSON recovery also failed: Expecting value: line 2 column 16 (char 17)
2026-01-31 09:11:26,754 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:11:29,685 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:11:29,687 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:14:58,973 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:14:58,998 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:14:59,022 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:14:59,044 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:15:00,625 - analysis.merged_analytics - INFO - Analyzing call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e...
2026-01-31 09:15:00,625 - analysis.merged_analytics - INFO - Processing call - Word count: 196, Duration: 60s, Text length: 1155 chars
2026-01-31 09:15:00,625 - analysis.merged_analytics - INFO - Step 1/7: Analyzing sentiment...
2026-01-31 09:15:00,625 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:15:00,735 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:03,340 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:03,346 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:15:03,346 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:05,450 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:05,453 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON
2026-01-31 09:15:05,453 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:08,004 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:08,005 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is
2026-01-31 09:15:08,006 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:10,417 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:10,419 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:15:10,419 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:12,613 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:12,614 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:15:12,614 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:15:12,616 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:14,559 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:14,561 - analysis.gemini_client - WARNING - Could not extract JSON from response: H
2026-01-31 09:15:14,561 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:16,400 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:16,404 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is
2026-01-31 09:15:16,405 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:18,243 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:18,246 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here
2026-01-31 09:15:18,246 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:20,191 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:20,193 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is
2026-01-31 09:15:20,193 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:22,238 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:22,240 - analysis.gemini_client - WARNING - Could not extract JSON from response: H
2026-01-31 09:15:22,240 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:15:22,241 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:26,622 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:26,623 - analysis.merged_analytics - INFO - Step 2/7: Generating summary...
2026-01-31 09:15:26,623 - analysis.merged_analytics - INFO - Starting summary generation...
2026-01-31 09:15:26,623 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:35,785 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:35,788 - analysis.merged_analytics - INFO - Summary generation complete - Key points: 3, Questions: 0
2026-01-31 09:15:35,789 - analysis.merged_analytics - INFO - Step 3/7: Determining lead disposition...
2026-01-31 09:15:35,789 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:40,155 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:40,163 - analysis.merged_analytics - INFO - Lead disposition: FOLLOW UP IN 3 DAYS - Action: Follow up at the requested time (6:00 PM GST
2026-01-31 09:15:40,163 - analysis.merged_analytics - INFO - Step 4/7: Calculating lead score from disposition...
2026-01-31 09:15:40,164 - analysis.merged_analytics - INFO - Lead score: 8.0/10 - Category: warm Lead
2026-01-31 09:15:40,164 - analysis.merged_analytics - INFO - Step 5/7: Calculating quality metrics...
2026-01-31 09:15:40,165 - analysis.merged_analytics - INFO - Step 6/7: Extracting call stages...
2026-01-31 09:15:40,166 - analysis.merged_analytics - INFO - Step 7/7: Extracting lead information...
2026-01-31 09:15:40,166 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:44,358 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:44,360 - analysis.gemini_client - ERROR - JSON decode error: Unterminated string starting at: line 2 column 15 (char 16)
2026-01-31 09:15:44,362 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
"first_name": "null
2026-01-31 09:15:44,363 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_091544.txt
2026-01-31 09:15:44,365 - analysis.gemini_client - ERROR - JSON recovery also failed: Unterminated string starting at: line 2 column 15 (char 16)
2026-01-31 09:15:44,366 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:48,800 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:48,858 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 2 column 14 (char 15)
2026-01-31 09:15:48,858 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
"first_name":
2026-01-31 09:15:48,858 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_091548.txt
2026-01-31 09:15:48,859 - analysis.gemini_client - ERROR - JSON recovery also failed: Expecting value: line 2 column 14 (char 15)
2026-01-31 09:15:48,860 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:53,163 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:53,164 - analysis.gemini_client - ERROR - JSON decode error: Unterminated string starting at: line 2 column 15 (char 16)
2026-01-31 09:15:53,164 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
"first_name": "
2026-01-31 09:15:53,166 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_091553.txt
2026-01-31 09:15:53,166 - analysis.gemini_client - ERROR - JSON recovery also failed: Unterminated string starting at: line 2 column 15 (char 16)
2026-01-31 09:15:53,167 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:15:57,326 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:15:57,330 - analysis.gemini_client - ERROR - JSON decode error: Unterminated string starting at: line 2 column 3 (char 4)
2026-01-31 09:15:57,331 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
  "first_
2026-01-31 09:15:57,334 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_091557.txt
2026-01-31 09:15:57,335 - analysis.gemini_client - ERROR - JSON recovery also failed: Unterminated string starting at: line 2 column 3 (char 4)
2026-01-31 09:15:57,335 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:16:01,560 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:16:01,562 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 2 column 14 (char 15)
2026-01-31 09:16:01,562 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
"first_name":
2026-01-31 09:16:01,563 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_091601.txt
2026-01-31 09:16:01,563 - analysis.gemini_client - ERROR - JSON recovery also failed: Expecting value: line 2 column 14 (char 15)
2026-01-31 09:16:01,563 - analysis.lead_info_extractor - WARNING - No result from structured generation
2026-01-31 09:16:01,565 - analysis.lead_info_extractor - WARNING - LLM did not return lead information
2026-01-31 09:16:01,565 - analysis.merged_analytics - INFO - LLM cost for this call: $0.000000 (0 tokens)
2026-01-31 09:16:01,565 - analysis.merged_analytics - INFO - Call analysis complete - Call ID: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, Lead Score: 8.0/10, Disposition: FOLLOW UP IN 3 DAYS
2026-01-31 09:16:03,187 - analysis.merged_analytics - INFO - Updated tags column in leads table (lead_id: 15edc307-a954-4674-8be9-5b8876df9c11, tags: ['warm Lead'])
2026-01-31 09:16:03,187 - analysis.merged_analytics - INFO - Analytics saved to database (call_log_id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e)
2026-01-31 09:16:03,962 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 09:16:04,177 - utils.vertical_routing - INFO - Vertical routing: tenant_id=734cd516-e252-4728-9c52-4663ee552653, vertical=general
2026-01-31 09:16:04,177 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:16:04,252 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:16:09,751 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:16:10,181 - utils.vertical_routing - INFO - General vertical: Updated lead_extraction for call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e with 6 fields
2026-01-31 09:16:10,182 - post_call_analysis.runner - INFO - Vertical routing: call_log_id=bc7815e3-04da-4a6c-84c3-0ef6f2165f1e routed to lad_dev.voice_call_analysis (vertical=general)
2026-01-31 09:16:11,758 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 09:16:11,758 - analysis.lead_bookings_extractor - INFO - Conversation length: 1186 chars
2026-01-31 09:16:11,760 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:16:17,023 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:16:17,026 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:16:19,485 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:16:19,487 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:16:19,487 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:16:21,937 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:16:21,940 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:16:21,940 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:16:23,883 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:16:23,885 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is
2026-01-31 09:16:23,885 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:16:26,136 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:16:26,138 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:16:26,138 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:16:28,491 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:16:28,492 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:16:28,494 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:30:34,133 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:30:34,154 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:30:34,178 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:30:34,198 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:30:35,699 - analysis.merged_analytics - INFO - Analyzing call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e...
2026-01-31 09:30:35,699 - analysis.merged_analytics - INFO - Processing call - Word count: 196, Duration: 60s, Text length: 1155 chars
2026-01-31 09:30:35,699 - analysis.merged_analytics - INFO - Step 1/7: Analyzing sentiment...
2026-01-31 09:30:35,699 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:30:35,801 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:30:38,422 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:30:38,423 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:30:38,423 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON
2026-01-31 09:30:38,423 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:30:40,893 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:30:40,896 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:30:40,896 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON
2026-01-31 09:30:40,897 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:30:43,212 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:30:43,214 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:30:43,215 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is
2026-01-31 09:30:43,215 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:30:45,182 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:30:45,183 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:30:45,183 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:30:45,183 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:30:47,639 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:30:47,639 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:30:47,641 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:30:47,641 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:30:47,642 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:30:49,487 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:30:49,489 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:30:49,489 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here
2026-01-31 09:30:49,489 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:30:51,632 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:30:51,634 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:30:51,634 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the
2026-01-31 09:30:51,635 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:30:53,640 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:30:53,642 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:30:53,642 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is
2026-01-31 09:30:53,642 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:30:55,499 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:30:55,503 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:30:55,504 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here
2026-01-31 09:30:55,504 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:30:57,264 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:30:57,267 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:30:57,267 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the
2026-01-31 09:30:57,267 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:30:57,268 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:01,604 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:01,605 - analysis.merged_analytics - INFO - Step 2/7: Generating summary...
2026-01-31 09:31:01,605 - analysis.merged_analytics - INFO - Starting summary generation...
2026-01-31 09:31:01,605 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:13,751 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:13,753 - analysis.merged_analytics - INFO - Summary generation complete - Key points: 3, Questions: 0
2026-01-31 09:31:13,753 - analysis.merged_analytics - INFO - Step 3/7: Determining lead disposition...
2026-01-31 09:31:13,753 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:18,051 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:18,054 - analysis.merged_analytics - INFO - Lead disposition: FOLLOW UP IN 3 DAYS - Action: Conduct the scheduled follow-up call tomorrow at 6:
2026-01-31 09:31:18,054 - analysis.merged_analytics - INFO - Step 4/7: Calculating lead score from disposition...
2026-01-31 09:31:18,054 - analysis.merged_analytics - INFO - Lead score: 8.0/10 - Category: warm Lead
2026-01-31 09:31:18,054 - analysis.merged_analytics - INFO - Step 5/7: Calculating quality metrics...
2026-01-31 09:31:18,054 - analysis.merged_analytics - INFO - Step 6/7: Extracting call stages...
2026-01-31 09:31:18,055 - analysis.merged_analytics - INFO - Step 7/7: Extracting lead information...
2026-01-31 09:31:18,055 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:22,070 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:22,072 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:22,073 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 2 column 16 (char 17)
2026-01-31 09:31:22,073 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
  "first_name":
2026-01-31 09:31:22,073 - analysis.gemini_client - ERROR - Response length: 17 chars - may be truncated
2026-01-31 09:31:22,073 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_093122.txt
2026-01-31 09:31:22,073 - analysis.gemini_client - ERROR - JSON recovery also failed: Expecting value: line 2 column 16 (char 17)
2026-01-31 09:31:22,073 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:26,345 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:26,346 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:26,346 - analysis.gemini_client - ERROR - JSON decode error: Unterminated string starting at: line 2 column 3 (char 4)
2026-01-31 09:31:26,346 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
  "first_
2026-01-31 09:31:26,346 - analysis.gemini_client - ERROR - Response length: 11 chars - may be truncated
2026-01-31 09:31:26,348 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_093126.txt
2026-01-31 09:31:26,348 - analysis.gemini_client - ERROR - JSON recovery also failed: Unterminated string starting at: line 2 column 3 (char 4)
2026-01-31 09:31:26,348 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:30,750 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:30,752 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:30,752 - analysis.gemini_client - ERROR - JSON decode error: Expecting value: line 2 column 14 (char 15)
2026-01-31 09:31:30,752 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
"first_name":
2026-01-31 09:31:30,752 - analysis.gemini_client - ERROR - Response length: 15 chars - may be truncated
2026-01-31 09:31:30,753 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_093130.txt
2026-01-31 09:31:30,753 - analysis.gemini_client - ERROR - JSON recovery also failed: Expecting value: line 2 column 14 (char 15)
2026-01-31 09:31:30,753 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:30,781 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:31:30,805 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:31:30,830 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:31:30,852 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:31:32,390 - analysis.merged_analytics - INFO - Analyzing call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e...
2026-01-31 09:31:32,391 - analysis.merged_analytics - INFO - Processing call - Word count: 196, Duration: 60s, Text length: 1155 chars
2026-01-31 09:31:32,392 - analysis.merged_analytics - INFO - Step 1/7: Analyzing sentiment...
2026-01-31 09:31:32,392 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:31:32,496 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:34,853 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:34,856 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:34,857 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the
2026-01-31 09:31:34,858 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:35,086 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:35,087 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:35,087 - analysis.gemini_client - ERROR - JSON decode error: Unterminated string starting at: line 2 column 1 (char 2)
2026-01-31 09:31:35,087 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
"first_name
2026-01-31 09:31:35,087 - analysis.gemini_client - ERROR - Response length: 13 chars - may be truncated
2026-01-31 09:31:35,089 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_093135.txt
2026-01-31 09:31:35,089 - analysis.gemini_client - ERROR - JSON recovery also failed: Unterminated string starting at: line 2 column 1 (char 2)
2026-01-31 09:31:35,089 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:36,894 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:36,896 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:36,896 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the
2026-01-31 09:31:36,896 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:39,139 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:39,141 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:39,143 - analysis.gemini_client - ERROR - JSON decode error: Unterminated string starting at: line 2 column 15 (char 16)
2026-01-31 09:31:39,143 - analysis.gemini_client - ERROR - Raw response that failed to parse:
{
"first_name": "null
2026-01-31 09:31:39,143 - analysis.gemini_client - ERROR - Response length: 21 chars - may be truncated
2026-01-31 09:31:39,143 - analysis.gemini_client - ERROR - Failed response saved to: D:\vonage\vonage-voice-agent\v2\analysis\logs\debug_responses\failed_response_20260131_093139.txt
2026-01-31 09:31:39,143 - analysis.gemini_client - ERROR - JSON recovery also failed: Unterminated string starting at: line 2 column 15 (char 16)
2026-01-31 09:31:39,143 - analysis.lead_info_extractor - WARNING - No result from structured generation
2026-01-31 09:31:39,143 - analysis.lead_info_extractor - WARNING - LLM did not return lead information
2026-01-31 09:31:39,143 - analysis.merged_analytics - INFO - LLM cost for this call: $0.000000 (0 tokens)
2026-01-31 09:31:39,146 - analysis.merged_analytics - INFO - Call analysis complete - Call ID: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, Lead Score: 8.0/10, Disposition: FOLLOW UP IN 3 DAYS
2026-01-31 09:31:39,366 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:39,370 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:39,370 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:31:39,370 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:40,036 - analysis.merged_analytics - INFO - Updated tags column in leads table (lead_id: 15edc307-a954-4674-8be9-5b8876df9c11, tags: ['warm Lead'])
2026-01-31 09:31:40,036 - analysis.merged_analytics - INFO - Analytics saved to database (call_log_id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e)
2026-01-31 09:31:40,782 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 09:31:40,996 - utils.vertical_routing - INFO - Vertical routing: tenant_id=734cd516-e252-4728-9c52-4663ee552653, vertical=general
2026-01-31 09:31:40,996 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:31:41,062 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:41,705 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:41,708 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:41,708 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON
2026-01-31 09:31:41,709 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:44,164 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:44,165 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:44,166 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON requested
2026-01-31 09:31:44,166 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:31:44,167 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:46,110 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:46,266 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:46,267 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:46,268 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is
2026-01-31 09:31:46,269 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:46,523 - utils.vertical_routing - INFO - General vertical: Updated lead_extraction for call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e with 4 fields
2026-01-31 09:31:46,523 - post_call_analysis.runner - INFO - Vertical routing: call_log_id=bc7815e3-04da-4a6c-84c3-0ef6f2165f1e routed to lad_dev.voice_call_analysis (vertical=general)
2026-01-31 09:31:48,055 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 09:31:48,055 - analysis.lead_bookings_extractor - INFO - Conversation length: 1186 chars
2026-01-31 09:31:48,058 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:48,318 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:48,320 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:48,320 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here
2026-01-31 09:31:48,321 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:50,308 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:50,310 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:50,311 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the
2026-01-31 09:31:50,312 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:52,459 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:52,460 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:52,460 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here
2026-01-31 09:31:52,462 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:53,488 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:54,505 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:54,508 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:31:54,508 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the
2026-01-31 09:31:54,509 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:31:54,510 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:31:58,969 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:31:58,970 - analysis.merged_analytics - INFO - Step 2/7: Generating summary...
2026-01-31 09:31:58,971 - analysis.merged_analytics - INFO - Starting summary generation...
2026-01-31 09:31:58,971 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:32:11,299 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:32:11,303 - analysis.merged_analytics - INFO - Summary generation complete - Key points: 4, Questions: 0
2026-01-31 09:32:11,304 - analysis.merged_analytics - INFO - Step 3/7: Determining lead disposition...
2026-01-31 09:32:11,304 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:32:16,113 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:32:16,116 - analysis.merged_analytics - INFO - Lead disposition: FOLLOW UP IN 3 DAYS - Action: Conduct the scheduled follow-up call tomorrow at 6
2026-01-31 09:32:16,116 - analysis.merged_analytics - INFO - Step 4/7: Calculating lead score from disposition...
2026-01-31 09:32:16,117 - analysis.merged_analytics - INFO - Lead score: 8.0/10 - Category: warm Lead
2026-01-31 09:32:16,118 - analysis.merged_analytics - INFO - Step 5/7: Calculating quality metrics...
2026-01-31 09:32:16,118 - analysis.merged_analytics - INFO - Step 6/7: Extracting call stages...
2026-01-31 09:32:16,119 - analysis.merged_analytics - INFO - Step 7/7: Extracting lead information...
2026-01-31 09:32:16,119 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:32:18,878 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:32:18,880 - analysis.lead_info_extractor - INFO - Lead info extracted: 5 fields
2026-01-31 09:32:18,881 - analysis.lead_info_extractor - INFO - Lead info saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_bc7815e3_20260131_093218.json
2026-01-31 09:32:18,881 - analysis.merged_analytics - INFO - Lead info extracted: 5 fields, saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_bc7815e3_20260131_093218.json
2026-01-31 09:32:18,881 - analysis.merged_analytics - INFO - LLM cost for this call: $0.000000 (0 tokens)
2026-01-31 09:32:18,882 - analysis.merged_analytics - INFO - Call analysis complete - Call ID: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, Lead Score: 8.0/10, Disposition: FOLLOW UP IN 3 DAYS
2026-01-31 09:32:19,796 - analysis.merged_analytics - INFO - Updated tags column in leads table (lead_id: 15edc307-a954-4674-8be9-5b8876df9c11, tags: ['warm Lead'])
2026-01-31 09:32:19,796 - analysis.merged_analytics - INFO - Analytics saved to database (call_log_id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e)
2026-01-31 09:32:20,612 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 09:32:20,835 - utils.vertical_routing - INFO - Vertical routing: tenant_id=734cd516-e252-4728-9c52-4663ee552653, vertical=general
2026-01-31 09:32:20,835 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:32:20,903 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:32:26,517 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:32:27,043 - utils.vertical_routing - INFO - General vertical: Updated lead_extraction for call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e with 4 fields
2026-01-31 09:32:27,046 - post_call_analysis.runner - INFO - Vertical routing: call_log_id=bc7815e3-04da-4a6c-84c3-0ef6f2165f1e routed to lad_dev.voice_call_analysis (vertical=general)
2026-01-31 09:32:28,506 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 09:32:28,506 - analysis.lead_bookings_extractor - INFO - Conversation length: 1186 chars
2026-01-31 09:32:28,508 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:32:30,449 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:32:30,455 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:32:32,702 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:32:32,705 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:32:32,705 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the
2026-01-31 09:32:32,705 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:32:34,851 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:32:34,851 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:32:34,854 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON
2026-01-31 09:32:34,855 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:32:37,002 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:32:37,004 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:32:37,004 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the
2026-01-31 09:32:37,005 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:32:39,055 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:32:39,055 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:32:39,058 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON
2026-01-31 09:32:39,059 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:32:41,201 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:32:41,202 - analysis.gemini_client - WARNING - API response may be incomplete. finish_reason: FinishReason.MAX_TOKENS
2026-01-31 09:32:41,203 - analysis.gemini_client - WARNING - Could not extract JSON from response: Here is the JSON
2026-01-31 09:32:41,204 - analysis.merged_analytics - WARNING - No result from structured generation
2026-01-31 09:33:05,161 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:33:05,185 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:33:05,218 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:33:05,255 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:33:07,083 - analysis.merged_analytics - INFO - Analyzing call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e...
2026-01-31 09:33:07,083 - analysis.merged_analytics - INFO - Processing call - Word count: 196, Duration: 60s, Text length: 1155 chars
2026-01-31 09:33:07,084 - analysis.merged_analytics - INFO - Step 1/7: Analyzing sentiment...
2026-01-31 09:33:07,084 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:33:07,198 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:33:09,085 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:33:09,087 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:33:13,340 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:33:13,343 - analysis.merged_analytics - INFO - Step 2/7: Generating summary...
2026-01-31 09:33:13,343 - analysis.merged_analytics - INFO - Starting summary generation...
2026-01-31 09:33:13,346 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:33:23,390 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:33:23,394 - analysis.merged_analytics - INFO - Summary generation complete - Key points: 4, Questions: 0
2026-01-31 09:33:23,394 - analysis.merged_analytics - INFO - Step 3/7: Determining lead disposition...
2026-01-31 09:33:23,396 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:33:28,408 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:33:28,410 - analysis.merged_analytics - INFO - Lead disposition: FOLLOW UP IN 3 DAYS - Action: Call the prospect at 6:00 PM GST
2026-01-31 09:33:28,410 - analysis.merged_analytics - INFO - Step 4/7: Calculating lead score from disposition...
2026-01-31 09:33:28,410 - analysis.merged_analytics - INFO - Lead score: 8.0/10 - Category: warm Lead
2026-01-31 09:33:28,410 - analysis.merged_analytics - INFO - Step 5/7: Calculating quality metrics...
2026-01-31 09:33:28,410 - analysis.merged_analytics - INFO - Step 6/7: Extracting call stages...
2026-01-31 09:33:28,411 - analysis.merged_analytics - INFO - Step 7/7: Extracting lead information...
2026-01-31 09:33:28,411 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:33:31,484 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:33:31,487 - analysis.lead_info_extractor - INFO - Lead info extracted: 5 fields
2026-01-31 09:33:31,488 - analysis.lead_info_extractor - INFO - Lead info saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_bc7815e3_20260131_093331.json
2026-01-31 09:33:31,488 - analysis.merged_analytics - INFO - Lead info extracted: 5 fields, saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_bc7815e3_20260131_093331.json
2026-01-31 09:33:31,488 - analysis.merged_analytics - INFO - LLM cost for this call: $0.000000 (0 tokens)
2026-01-31 09:33:31,488 - analysis.merged_analytics - INFO - Call analysis complete - Call ID: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, Lead Score: 8.0/10, Disposition: FOLLOW UP IN 3 DAYS
2026-01-31 09:33:32,246 - analysis.merged_analytics - INFO - Updated tags column in leads table (lead_id: 15edc307-a954-4674-8be9-5b8876df9c11, tags: ['warm Lead'])
2026-01-31 09:33:32,248 - analysis.merged_analytics - INFO - Analytics saved to database (call_log_id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e)
2026-01-31 09:33:33,001 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 09:33:33,212 - utils.vertical_routing - INFO - Vertical routing: tenant_id=734cd516-e252-4728-9c52-4663ee552653, vertical=general
2026-01-31 09:33:33,213 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:33:33,278 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:33:38,853 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:33:39,285 - utils.vertical_routing - INFO - General vertical: Updated lead_extraction for call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e with 4 fields
2026-01-31 09:33:39,285 - post_call_analysis.runner - INFO - Vertical routing: call_log_id=bc7815e3-04da-4a6c-84c3-0ef6f2165f1e routed to lad_dev.voice_call_analysis (vertical=general)
2026-01-31 09:33:40,801 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 09:33:40,801 - analysis.lead_bookings_extractor - INFO - Conversation length: 1186 chars
2026-01-31 09:33:40,803 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:33:42,949 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:33:42,952 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:33:44,688 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:39:10,755 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:39:10,780 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:39:10,803 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 09:39:10,828 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 09:39:12,308 - analysis.merged_analytics - INFO - Analyzing call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e...
2026-01-31 09:39:12,308 - analysis.merged_analytics - INFO - Processing call - Word count: 196, Duration: 60s, Text length: 1155 chars
2026-01-31 09:39:12,309 - analysis.merged_analytics - INFO - Step 1/7: Analyzing sentiment...
2026-01-31 09:39:12,309 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:39:12,418 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:39:14,628 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:39:14,635 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:39:19,031 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:39:19,034 - analysis.merged_analytics - INFO - Step 2/7: Generating summary...
2026-01-31 09:39:19,034 - analysis.merged_analytics - INFO - Starting summary generation...
2026-01-31 09:39:19,035 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:39:31,421 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:39:31,423 - analysis.merged_analytics - INFO - Summary generation complete - Key points: 3, Questions: 0
2026-01-31 09:39:31,423 - analysis.merged_analytics - INFO - Step 3/7: Determining lead disposition...
2026-01-31 09:39:31,423 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:39:35,619 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:39:35,623 - analysis.merged_analytics - INFO - Lead disposition: PROCEED IMMEDIATELY - Action: Conduct the scheduled follow-up call tomorrow at 6
2026-01-31 09:39:35,623 - analysis.merged_analytics - INFO - Step 4/7: Calculating lead score from disposition...
2026-01-31 09:39:35,623 - analysis.merged_analytics - INFO - Lead score: 10.0/10 - Category: Hot Lead
2026-01-31 09:39:35,623 - analysis.merged_analytics - INFO - Step 5/7: Calculating quality metrics...
2026-01-31 09:39:35,623 - analysis.merged_analytics - INFO - Step 6/7: Extracting call stages...
2026-01-31 09:39:35,626 - analysis.merged_analytics - INFO - Step 7/7: Extracting lead information...
2026-01-31 09:39:35,626 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:39:38,281 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:39:38,284 - analysis.lead_info_extractor - INFO - Lead info extracted: 5 fields
2026-01-31 09:39:38,285 - analysis.lead_info_extractor - INFO - Lead info saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_bc7815e3_20260131_093938.json
2026-01-31 09:39:38,286 - analysis.merged_analytics - INFO - Lead info extracted: 5 fields, saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_bc7815e3_20260131_093938.json
2026-01-31 09:39:38,286 - analysis.merged_analytics - INFO - LLM cost for this call: $0.000000 (0 tokens)
2026-01-31 09:39:38,286 - analysis.merged_analytics - INFO - Call analysis complete - Call ID: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, Lead Score: 10.0/10, Disposition: PROCEED IMMEDIATELY
2026-01-31 09:39:39,410 - analysis.merged_analytics - INFO - Updated tags column in leads table (lead_id: 15edc307-a954-4674-8be9-5b8876df9c11, tags: ['Hot Lead'])
2026-01-31 09:39:39,410 - analysis.merged_analytics - INFO - Analytics saved to database (call_log_id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e)
2026-01-31 09:39:40,158 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 09:39:40,353 - utils.vertical_routing - INFO - Vertical routing: tenant_id=734cd516-e252-4728-9c52-4663ee552653, vertical=general
2026-01-31 09:39:40,353 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 09:39:40,416 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:39:46,373 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:39:46,763 - utils.vertical_routing - INFO - General vertical: Updated lead_extraction for call bc7815e3-04da-4a6c-84c3-0ef6f2165f1e with 3 fields
2026-01-31 09:39:46,764 - post_call_analysis.runner - INFO - Vertical routing: call_log_id=bc7815e3-04da-4a6c-84c3-0ef6f2165f1e routed to lad_dev.voice_call_analysis (vertical=general)
2026-01-31 09:39:48,722 - analysis.lead_bookings_extractor - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 09:39:48,722 - analysis.lead_bookings_extractor - INFO - Conversation length: 1186 chars
2026-01-31 09:39:48,723 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:39:50,673 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 09:39:50,675 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 09:39:52,310 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 11:38:39,249 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 11:38:39,311 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 11:38:39,380 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 11:38:39,553 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 11:38:43,851 - __main__ - INFO - Fetching call from database (ID: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e)
2026-01-31 11:38:44,467 - __main__ - INFO - Call ID: DB_bc7815e3-04da-4a6c-84c3-0ef6f2165f1e_20260130_172644, Duration: 117s, Started: 2026-01-30 17:26:44.955066+00:00, Ended: 2026-01-30 17:28:42.883583+00:00
2026-01-31 11:38:44,468 - __main__ - INFO - Analyzing call DB_bc7815e3-04da-4a6c-84c3-0ef6f2165f1e_20260130_172644...
2026-01-31 11:38:44,469 - __main__ - INFO - Parsed 15 total messages from voiceagent format (8 user, 7 agent, filtered from 16 total segments)
2026-01-31 11:38:44,470 - __main__ - INFO - Processing call - Word count: 196, Duration: 117s, Text length: 1141 chars
2026-01-31 11:38:44,470 - __main__ - INFO - Step 1/7: Analyzing sentiment...
2026-01-31 11:38:44,471 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 11:38:44,768 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 11:38:46,454 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 11:38:46,474 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 11:38:55,316 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 11:38:55,324 - __main__ - INFO - Step 2/7: Generating summary...
2026-01-31 11:38:55,324 - __main__ - INFO - Starting summary generation...
2026-01-31 11:38:55,326 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 11:39:04,405 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 11:39:04,415 - __main__ - INFO - Summary generation complete - Key points: 3, Questions: 0
2026-01-31 11:39:04,416 - __main__ - INFO - Step 3/7: Determining lead disposition...
2026-01-31 11:39:04,418 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 11:39:10,583 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 11:39:10,751 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 11:39:10,930 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 11:39:11,036 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 11:39:15,694 - __main__ - INFO - Fetching call from database (ID: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e)
2026-01-31 11:39:16,274 - __main__ - INFO - Call ID: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, Started: 2026-01-30 17:26:44.955066+00:00, Ended: 2026-01-30 17:28:42.883583+00:00, Lead ID: 15edc307-a954-4674-8be9-5b8876df9c11
2026-01-31 11:39:16,276 - __main__ - INFO - Conversation text length: 3960 characters
2026-01-31 11:39:16,330 - __main__ - INFO - Full conversation text length: 3960 characters
2026-01-31 11:39:16,330 - __main__ - INFO - Sample (first 500 chars): {"call_id": "bc7815e3-04da-4a6c-84c3-0ef6f2165f1e", "ended_at": "2026-01-30T17:28:42.849779+00:00", "segments": [{"text": "Hi, this is Nithya from Sasya Spaces, Dubai. I hope I'm catching you at a good time?", "speaker": "agent", "timestamp": "2026-01-30T17:27:07.474068+00:00", "is_complete": true, "intended_text": null}, {"text": "Yes.", "speaker": "user", "timestamp": "2026-01-30T17:27:08.980384+00:00", "is_complete": true, "intended_text": null}, {"text": "Okay.", "speaker": "user", "timestam
2026-01-31 11:39:16,331 - __main__ - INFO - Sample (last 500 chars):  I can prepare the most relevant options\u2014especially those that qualify for the Golden Visa\u2014what is the best email address to send you a brief summary and a calendar invite for our chat tomorrow?"}, {"text": "You are most welcome. I", "speaker": "agent", "timestamp": "2026-01-30T17:28:12.527533+00:00", "is_complete": false, "intended_text": "You are most welcome. I completely understand. Thank you for your time, and have a great day!"}], "started_at": "2026-01-30T17:26:49.422480+00:00"}
2026-01-31 11:39:16,333 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 11:39:16,503 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 11:39:16,509 - __main__ - INFO - Lead disposition: FOLLOW UP IN 3 DAYS - Action: Follow up tomorrow at 6:00 PM GST to discuss budget range and Golden Visa qualifying projects.
2026-01-31 11:39:16,510 - __main__ - INFO - Step 4/7: Calculating lead score from disposition...
2026-01-31 11:39:16,510 - __main__ - INFO - Lead score: 8.0/10 - Category: warm Lead
2026-01-31 11:39:16,511 - __main__ - INFO - Step 5/7: Calculating quality metrics...
2026-01-31 11:39:16,512 - __main__ - INFO - Step 6/7: Extracting call stages...
2026-01-31 11:39:16,512 - __main__ - INFO - Step 7/7: Extracting lead information...
2026-01-31 11:39:16,513 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 11:39:16,618 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 11:39:17,980 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 11:39:18,066 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 11:39:18,180 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 11:39:18,263 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 11:39:18,956 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 11:39:18,974 - __main__ - INFO - Parsed student info from structured output: ['student_name', 'parent_name', 'parent_contact', 'parents_profession', 'parents_workplace', 'email', 'country_of_residence', 'nationality', 'grade_year', 'curriculum', 'school_name', 'lead_source', 'program_country_of_interest', 'academic_grades', 'counsellor_meeting_link', 'tags', 'stage', 'status', 'counsellor_email']
2026-01-31 11:39:18,974 - __main__ - INFO - Parent name from LLM: null
2026-01-31 11:39:18,975 - __main__ - INFO - Parent profession from LLM: null
2026-01-31 11:39:18,976 - __main__ - WARNING - No student information found in conversation
2026-01-31 11:39:18,977 - __main__ - INFO - Parsed data was: {'student_name': 'null', 'parent_name': 'null', 'parent_contact': 'null', 'parents_profession': 'null', 'parents_workplace': 'null', 'email': 'null', 'country_of_residence': 'Unknown', 'nationality': 'null', 'grade_year': 'null', 'curriculum': 'null', 'school_name': 'null', 'lead_source': 'Phone Call', 'program_country_of_interest': 'null', 'academic_grades': 'null', 'counsellor_meeting_link': 'null', 'tags': 'Dubai Golden Visa, Real Estate Investment', 'stage': 'Follow-up Scheduled', 'status': 'Interested', 'counsellor_email': 'null'}
2026-01-31 11:39:18,978 - __main__ - INFO - Student info extracted: {'student_name': None, 'parent_name': None, 'parent_contact': None, 'parents_profession': None, 'parents_workplace': None, 'email': None, 'country_of_residence': 'Unknown', 'nationality': None, 'grade_year': None, 'curriculum': None, 'school_name': None, 'lead_source': 'Phone Call', 'program_country_of_interest': None, 'academic_grades': None, 'counsellor_meeting_link': None, 'tags': 'Dubai Golden Visa, Real Estate Investment', 'stage': 'Follow-up Scheduled', 'status': 'Interested', 'counsellor_email': None}
2026-01-31 11:39:18,978 - __main__ - INFO - No student information found in this call transcript
2026-01-31 11:39:18,983 - __main__ - INFO - No student information extracted from this call.
2026-01-31 11:39:19,280 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 11:39:19,285 - analysis.lead_info_extractor - INFO - Lead info extracted: 5 fields
2026-01-31 11:39:19,287 - analysis.lead_info_extractor - INFO - Lead info saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_DB_bc781_20260131_113919.json
2026-01-31 11:39:19,288 - __main__ - INFO - Lead info extracted: 5 fields, saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_DB_bc781_20260131_113919.json
2026-01-31 11:39:19,288 - __main__ - INFO - LLM cost for this call: $0.000000 (0 tokens)
2026-01-31 11:39:19,289 - __main__ - INFO - Call analysis complete - Call ID: DB_bc7815e3-04da-4a6c-84c3-0ef6f2165f1e_20260130_172644, Lead Score: 8.0/10, Disposition: FOLLOW UP IN 3 DAYS
2026-01-31 11:39:19,289 - __main__ - INFO - Saving analytics to lad_dev.voice_call_analysis table...
2026-01-31 11:39:20,195 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 11:39:20,714 - __main__ - INFO - Analytics saved to lad_dev.voice_call_analysis (id=5b262c3a-bdd6-4ae9-840b-c3c3db31cc8c)
2026-01-31 11:39:21,273 - __main__ - INFO - Updated tags column in leads table (lead_id: 15edc307-a954-4674-8be9-5b8876df9c11, tags: ['warm Lead'])
2026-01-31 11:39:21,273 - __main__ - INFO - Analytics saved to database successfully!
2026-01-31 11:39:21,276 - __main__ - INFO - Analysis saved to: call_analysis_DB_bc7815e3-04da-4a6c-84c3-0ef6f2165f1e_20260130_172644_20260131_113921.json
2026-01-31 11:39:22,687 - __main__ - INFO - Processing call_id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, lead_id: 15edc307-a954-4674-8be9-5b8876df9c11
2026-01-31 11:39:22,689 - __main__ - INFO - Conversation length: 1155 chars
2026-01-31 11:39:22,689 - __main__ - INFO - Extracting student information from conversation (1155 chars)
2026-01-31 11:39:22,805 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 11:39:23,014 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 11:39:25,991 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 11:39:25,997 - __main__ - INFO - Parsed JSON from LLM: {
  "student_parent_name": "null",
  "parent_designation": "null",
  "program_interested_in": "null",
  "country_interested": "null",
  "intake_year": 0,
  "intake_month": "null",
  "metadata": {
    "email": "null",
    "phone": "null",
    "percentage": "null",
    "grades": "null",
    "class": "null",
    "school_name": "null",
    "curriculum": "null",
    "address": "null",
    "budget": "null",
    "preferred_university": "null",
    "subject_interests": "null",
    "followup_time": "tomorrow at 6:00 PM GST",
    "slot_booked_for": "null",
    "available_time": "null",
    "summary_last_call": "Agent contacted the user regarding Dubai Golden Visa and real estate investment; user requested a callback for the following day due to being busy.",
    "additional_notes": "The conversation is focused on real estate investment and the UAE Golden Visa rather than educational programs."
  }
}
2026-01-31 11:39:25,998 - __main__ - INFO - Parent name from LLM: null
2026-01-31 11:39:25,999 - __main__ - INFO - Parent designation from LLM: null
2026-01-31 11:39:26,000 - __main__ - INFO - Extracted student info: {
  "student_parent_name": null,
  "parent_designation": null,
  "program_interested_in": null,
  "country_interested": null,
  "intake_year": 0,
  "intake_month": null,
  "metadata": {
    "followup_time": "tomorrow at 6:00 PM GST",
    "summary_last_call": "Agent contacted the user regarding Dubai Golden Visa and real estate investment; user requested a callback for the following day due to being busy.",
    "additional_notes": "The conversation is focused on real estate investment and the UAE Golden Visa rather than educational programs."
  }
}
2026-01-31 11:39:26,003 - __main__ - INFO - Student information saved to JSON file: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lad_dev_bc7815e3_20260131_113926.json
2026-01-31 11:39:26,004 - __main__ - INFO - Saved to JSON: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lad_dev_bc7815e3_20260131_113926.json
2026-01-31 11:39:26,004 - __main__ - INFO - [SAVE_TO_DB] Function called - call_log_id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, lead_id: 15edc307-a954-4674-8be9-5b8876df9c11, tenant_id: 734cd516-e252-4728-9c52-4663ee552653
2026-01-31 11:39:26,618 - __main__ - INFO - Attempting to save/update - tenant_id: 734cd516-e252-4728-9c52-4663ee552653, lead_id: 15edc307-a954-4674-8be9-5b8876df9c11
2026-01-31 11:39:26,619 - __main__ - INFO - ON CONFLICT will UPDATE existing record if (tenant_id=734cd516-e252-4728-9c52-4663ee552653, lead_id=15edc307-a954-4674-8be9-5b8876df9c11) already exists
2026-01-31 11:39:26,777 - __main__ - INFO - Student information saved to database (call_log_id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e)
2026-01-31 11:39:26,781 - __main__ - INFO - Saved to database successfully
2026-01-31 11:39:28,531 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 11:39:28,578 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 11:39:28,633 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 11:39:28,698 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 11:39:32,247 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 11:39:32,248 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 11:39:32,756 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 11:39:33,279 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 11:39:33,522 - __main__ - DEBUG - Parsed 16 segments from transcripts
2026-01-31 11:39:33,522 - __main__ - INFO - call_id from transcription: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, fallback to voice_call_logs.id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, using: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e
2026-01-31 11:39:33,522 - __main__ - INFO - Extracting booking info from conversation (length: 1163 chars)
2026-01-31 11:39:33,523 - __main__ - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 11:39:33,523 - __main__ - INFO - Conversation length: 1163 chars
2026-01-31 11:39:33,523 - __main__ - DEBUG - Calling Gemini API with structured output: temperature=0.1, maxOutputTokens=4096
2026-01-31 11:39:33,526 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 11:39:33,710 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 11:39:33,716 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2026-01-31 11:39:33,739 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001B50F161970>
2026-01-31 11:39:33,739 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001B521B50CD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2026-01-31 11:39:33,756 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001B51D6CBB90>
2026-01-31 11:39:33,756 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 11:39:33,758 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 11:39:33,758 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 11:39:33,759 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 11:39:33,759 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 11:39:37,162 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 06:09:37 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=3391'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 11:39:37,165 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 11:39:37,166 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 11:39:37,168 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 11:39:37,168 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 11:39:37,169 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 11:39:37,172 - analysis.gemini_client - DEBUG - API finish_reason: FinishReason.STOP
2026-01-31 11:39:37,173 - analysis.gemini_client - DEBUG - Raw Gemini response (first 500 chars): {
"booking_type": "auto_followup",
"scheduled_at": "tomorrow at 6:00 PM GST",
"student_grade":  10,
"call_id": "id",
"has_future_discussion": true
}
2026-01-31 11:39:37,173 - analysis.gemini_client - DEBUG - Response length: 148 chars
2026-01-31 11:39:37,180 - __main__ - DEBUG - Booking extraction structured response received
2026-01-31 11:39:37,184 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': 'tomorrow at 6:00 PM GST', 'student_grade': 10, 'call_id': 'id'}
2026-01-31 11:39:37,488 - __main__ - WARNING - Booking already exists for call_id bc7815e3-04da-4a6c-84c3-0ef6f2165f1e - this is a duplicate call
2026-01-31 11:39:37,488 - __main__ - INFO - Student grade mentioned in conversation: Grade 10
2026-01-31 11:39:37,490 - __main__ - INFO - Found first timestamp in transcription: 2026-01-30T17:27:07.474068+00:00 -> 2026-01-30 17:27:07.474068+00:00 (UTC)
2026-01-31 11:39:37,491 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-30 17:27:07.474068+00:00 (UTC) -> 2026-01-30 21:27:07.474068+04:00 (GST)
2026-01-31 11:39:37,492 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-30 21:27:07+04:00 (GST)
2026-01-31 11:39:37,493 - __main__ - DEBUG - Call started at: 2026-01-30 21:26:44.955066+04:00, using transcription timestamp 2026-01-30 21:27:07+04:00 as reference for scheduling
2026-01-31 11:39:37,494 - __main__ - INFO - Time phrase 'tomorrow at 6:00 PM GST' is CONFIRMED
2026-01-31 11:39:37,495 - __main__ - INFO - Time explicitly mentioned in conversation: 'tomorrow at 6:00 PM GST' - using this time directly (no stage-based calculation)
2026-01-31 11:39:37,510 - __main__ - INFO - Found 'tomorrow' directly in scheduled_at_str: 'tomorrow at 6:00 PM GST'
2026-01-31 11:39:37,513 - __main__ - INFO - Absolute time 18:00 with parsed date 2026-01-31, scheduling for: 2026-01-31 18:00:00+04:00
2026-01-31 11:39:37,514 - __main__ - INFO - Absolute time detected: 'tomorrow at 6:00 pm gst' -> 2026-01-31 18:00:00+04:00
2026-01-31 11:39:39,010 - __main__ - WARNING - Duplicate call_id bc7815e3-04da-4a6c-84c3-0ef6f2165f1e detected, but retry_count based on lead_id and booking_type
2026-01-31 11:39:39,011 - __main__ - INFO - Existing bookings for lead_id 15edc307-a954-4674-8be9-5b8876df9c11 and booking_type auto_followup: 3
2026-01-31 11:39:39,013 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 2
2026-01-31 11:39:39,014 - __main__ - INFO - retry_count = 3 (max_retry_count + 1)
2026-01-31 11:39:39,016 - __main__ - INFO - parent_booking_id = f497b1d5-6259-445f-aca1-ea8a2f321768 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 11:39:39,017 - __main__ - INFO - Final retry count for call_id bc7815e3-04da-4a6c-84c3-0ef6f2165f1e: 3
2026-01-31 11:39:39,019 - __main__ - INFO - scheduled_at: 2026-01-31 18:00:00+04:00, buffer_until: 2026-01-31 18:15:00+04:00
2026-01-31 11:39:39,021 - __main__ - DEBUG - JSON file saving disabled for call_log_id=f497b1d5-6259-445f-aca1-ea8a2f321768
2026-01-31 11:39:39,022 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 11:39:39,023 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 11:39:39,267 - db.storage.leads - DEBUG - Lead 15edc307-a954-4674-8be9-5b8876df9c11 already assigned or not found
2026-01-31 11:39:39,517 - db.storage.lead_bookings - ERROR - Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(734cd516-e252-4728-9c52-4663ee552653, 15edc307-a954-4674-8be9-5b8876df9c11, 2026-01-31 18:00:00, auto_followup) already exists.
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\db\storage\lead_bookings.py", line 377, in save_booking
    cur.execute(f"""
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(734cd516-e252-4728-9c52-4663ee552653, 15edc307-a954-4674-8be9-5b8876df9c11, 2026-01-31 18:00:00, auto_followup) already exists.

2026-01-31 11:39:39,525 - __main__ - WARNING - Skipped database save: Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(734cd516-e252-4728-9c52-4663ee552653, 15edc307-a954-4674-8be9-5b8876df9c11, 2026-01-31 18:00:00, auto_followup) already exists.

2026-01-31 11:39:39,808 - httpcore.connection - DEBUG - close.started
2026-01-31 11:39:39,810 - httpcore.connection - DEBUG - close.complete
2026-01-31 12:06:39,110 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 12:06:39,135 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 12:06:39,166 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 12:06:39,190 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 12:06:41,018 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 12:06:41,018 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 12:06:41,394 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 12:06:41,793 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 12:06:42,016 - __main__ - DEBUG - Parsed 16 segments from transcripts
2026-01-31 12:06:42,016 - __main__ - INFO - call_id from transcription: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, fallback to voice_call_logs.id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, using: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e
2026-01-31 12:06:42,016 - __main__ - INFO - Extracting booking info from conversation (length: 1163 chars)
2026-01-31 12:06:42,016 - __main__ - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 12:06:42,017 - __main__ - INFO - Conversation length: 1163 chars
2026-01-31 12:06:42,017 - __main__ - DEBUG - Calling Gemini API with structured output: temperature=0.1, maxOutputTokens=4096
2026-01-31 12:06:42,019 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 12:06:42,125 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 12:06:42,128 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2026-01-31 12:06:42,159 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000232C070A450>
2026-01-31 12:06:42,160 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000232C0D40DD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2026-01-31 12:06:42,174 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000232C07186B0>
2026-01-31 12:06:42,174 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 12:06:42,175 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 12:06:42,175 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 12:06:42,176 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 12:06:42,176 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 12:06:43,556 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 06:36:44 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1373'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 12:06:43,557 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 12:06:43,558 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 12:06:43,558 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 12:06:43,558 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 12:06:43,558 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 12:06:43,559 - analysis.gemini_client - DEBUG - API finish_reason: FinishReason.STOP
2026-01-31 12:06:43,560 - analysis.gemini_client - DEBUG - Raw Gemini response (first 500 chars): {
"booking_type": "auto_followup",
"scheduled_at": "tomorrow at 6:00 PM GST",
"student_grade":  10,
"call_id": "id",
"has_future_discussion": true
}
2026-01-31 12:06:43,560 - analysis.gemini_client - DEBUG - Response length: 148 chars
2026-01-31 12:06:43,562 - __main__ - DEBUG - Booking extraction structured response received
2026-01-31 12:06:43,562 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': 'tomorrow at 6:00 PM GST', 'student_grade': 10, 'call_id': 'id'}
2026-01-31 12:06:43,839 - __main__ - WARNING - Booking already exists for call_id bc7815e3-04da-4a6c-84c3-0ef6f2165f1e - this is a duplicate call
2026-01-31 12:06:43,840 - __main__ - INFO - Student grade mentioned in conversation: Grade 10
2026-01-31 12:06:43,840 - __main__ - INFO - Found first timestamp in transcription: 2026-01-30T17:27:07.474068+00:00 -> 2026-01-30 17:27:07.474068+00:00 (UTC)
2026-01-31 12:06:43,840 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-30 17:27:07.474068+00:00 (UTC) -> 2026-01-30 21:27:07.474068+04:00 (GST)
2026-01-31 12:06:43,841 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-30 21:27:07+04:00 (GST)
2026-01-31 12:06:43,841 - __main__ - DEBUG - Call started at: 2026-01-30 21:26:44.955066+04:00, using transcription timestamp 2026-01-30 21:27:07+04:00 as reference for scheduling
2026-01-31 12:06:43,842 - __main__ - INFO - Time phrase 'tomorrow at 6:00 PM GST' is CONFIRMED
2026-01-31 12:06:43,842 - __main__ - INFO - Time explicitly mentioned in conversation: 'tomorrow at 6:00 PM GST' - using this time directly (no stage-based calculation)
2026-01-31 12:06:43,844 - __main__ - INFO - Found 'tomorrow' directly in scheduled_at_str: 'tomorrow at 6:00 PM GST'
2026-01-31 12:06:43,845 - __main__ - INFO - Absolute time 18:00 with parsed date 2026-01-31, scheduling for: 2026-01-31 18:00:00+04:00
2026-01-31 12:06:43,845 - __main__ - INFO - Absolute time detected: 'tomorrow at 6:00 pm gst' -> 2026-01-31 18:00:00+04:00
2026-01-31 12:06:45,089 - __main__ - WARNING - Duplicate call_id bc7815e3-04da-4a6c-84c3-0ef6f2165f1e detected, but retry_count based on lead_id and booking_type
2026-01-31 12:06:45,089 - __main__ - INFO - Existing bookings for lead_id 15edc307-a954-4674-8be9-5b8876df9c11 and booking_type auto_followup: 3
2026-01-31 12:06:45,090 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 2
2026-01-31 12:06:45,090 - __main__ - INFO - retry_count = 3 (max_retry_count + 1)
2026-01-31 12:06:45,090 - __main__ - INFO - parent_booking_id = f497b1d5-6259-445f-aca1-ea8a2f321768 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 12:06:45,091 - __main__ - INFO - Final retry count for call_id bc7815e3-04da-4a6c-84c3-0ef6f2165f1e: 3
2026-01-31 12:06:45,091 - __main__ - INFO - scheduled_at: 2026-01-31 18:00:00+04:00, buffer_until: 2026-01-31 18:15:00+04:00
2026-01-31 12:06:45,091 - __main__ - DEBUG - JSON file saving disabled for call_log_id=f497b1d5-6259-445f-aca1-ea8a2f321768
2026-01-31 12:06:45,092 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 12:06:45,092 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 12:06:45,311 - db.storage.leads - DEBUG - Lead 15edc307-a954-4674-8be9-5b8876df9c11 already assigned or not found
2026-01-31 12:06:45,533 - db.storage.lead_bookings - ERROR - Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(734cd516-e252-4728-9c52-4663ee552653, 15edc307-a954-4674-8be9-5b8876df9c11, 2026-01-31 18:00:00, auto_followup) already exists.
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\db\storage\lead_bookings.py", line 377, in save_booking
    cur.execute(f"""
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(734cd516-e252-4728-9c52-4663ee552653, 15edc307-a954-4674-8be9-5b8876df9c11, 2026-01-31 18:00:00, auto_followup) already exists.

2026-01-31 12:06:45,534 - __main__ - WARNING - Skipped database save: Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(734cd516-e252-4728-9c52-4663ee552653, 15edc307-a954-4674-8be9-5b8876df9c11, 2026-01-31 18:00:00, auto_followup) already exists.

2026-01-31 12:06:45,681 - httpcore.connection - DEBUG - close.started
2026-01-31 12:06:45,682 - httpcore.connection - DEBUG - close.complete
2026-01-31 12:11:19,941 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 12:11:19,963 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 12:11:19,986 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 12:11:20,008 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 12:11:21,806 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 12:11:21,806 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 12:11:22,187 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 12:11:22,573 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 12:11:22,781 - __main__ - DEBUG - Parsed 16 segments from transcripts
2026-01-31 12:11:22,781 - __main__ - INFO - call_id from transcription: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, fallback to voice_call_logs.id: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e, using: bc7815e3-04da-4a6c-84c3-0ef6f2165f1e
2026-01-31 12:11:22,781 - __main__ - INFO - Extracting booking info from conversation (length: 1163 chars)
2026-01-31 12:11:22,781 - __main__ - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 12:11:22,783 - __main__ - INFO - Conversation length: 1163 chars
2026-01-31 12:11:22,783 - __main__ - DEBUG - Calling Gemini API with structured output: temperature=0.1, maxOutputTokens=4096
2026-01-31 12:11:22,784 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 12:11:22,911 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 12:11:22,916 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2026-01-31 12:11:22,938 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002385688B080>
2026-01-31 12:11:22,938 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000238569FA350> server_hostname='generativelanguage.googleapis.com' timeout=None
2026-01-31 12:11:22,958 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002385688BB00>
2026-01-31 12:11:22,958 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 12:11:22,958 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 12:11:22,959 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 12:11:22,960 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 12:11:22,960 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 12:11:24,785 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 06:41:25 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1819'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 12:11:24,787 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 12:11:24,787 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 12:11:24,789 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 12:11:24,789 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 12:11:24,789 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 12:11:24,791 - analysis.gemini_client - DEBUG - API finish_reason: FinishReason.STOP
2026-01-31 12:11:24,792 - analysis.gemini_client - DEBUG - Raw Gemini response (first 500 chars): {
"booking_type": "auto_followup",
"scheduled_at": "tomorrow at 6:00 PM GST",
"student_grade":  10,
"call_id": "id",
"has_future_discussion": true
}
2026-01-31 12:11:24,792 - analysis.gemini_client - DEBUG - Response length: 148 chars
2026-01-31 12:11:24,794 - __main__ - DEBUG - Booking extraction structured response received
2026-01-31 12:11:24,795 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': 'tomorrow at 6:00 PM GST', 'student_grade': 10, 'call_id': 'id'}
2026-01-31 12:11:25,055 - __main__ - WARNING - Booking already exists for call_id bc7815e3-04da-4a6c-84c3-0ef6f2165f1e - this is a duplicate call
2026-01-31 12:11:25,055 - __main__ - INFO - Student grade mentioned in conversation: Grade 10
2026-01-31 12:11:25,055 - __main__ - INFO - Found first timestamp in transcription: 2026-01-30T17:27:07.474068+00:00 -> 2026-01-30 17:27:07.474068+00:00 (UTC)
2026-01-31 12:11:25,055 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-30 17:27:07.474068+00:00 (UTC) -> 2026-01-30 21:27:07.474068+04:00 (GST)
2026-01-31 12:11:25,055 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-30 21:27:07+04:00 (GST)
2026-01-31 12:11:25,056 - __main__ - DEBUG - Call started at: 2026-01-30 21:26:44.955066+04:00, using transcription timestamp 2026-01-30 21:27:07+04:00 as reference for scheduling
2026-01-31 12:11:25,056 - __main__ - INFO - Time phrase 'tomorrow at 6:00 PM GST' is CONFIRMED
2026-01-31 12:11:25,056 - __main__ - INFO - Time explicitly mentioned in conversation: 'tomorrow at 6:00 PM GST' - using this time directly (no stage-based calculation)
2026-01-31 12:11:25,060 - __main__ - INFO - Found 'tomorrow' directly in scheduled_at_str: 'tomorrow at 6:00 PM GST'
2026-01-31 12:11:25,060 - __main__ - INFO - Absolute time 18:00 with parsed date 2026-01-31, scheduling for: 2026-01-31 18:00:00+04:00
2026-01-31 12:11:25,061 - __main__ - INFO - Absolute time detected: 'tomorrow at 6:00 pm gst' -> 2026-01-31 18:00:00+04:00
2026-01-31 12:11:26,156 - __main__ - WARNING - Duplicate call_id bc7815e3-04da-4a6c-84c3-0ef6f2165f1e detected, but retry_count based on lead_id and booking_type
2026-01-31 12:11:26,156 - __main__ - INFO - Existing bookings for lead_id 15edc307-a954-4674-8be9-5b8876df9c11 and booking_type auto_followup: 3
2026-01-31 12:11:26,156 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 2
2026-01-31 12:11:26,156 - __main__ - INFO - retry_count = 3 (max_retry_count + 1)
2026-01-31 12:11:26,156 - __main__ - INFO - parent_booking_id = f497b1d5-6259-445f-aca1-ea8a2f321768 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 12:11:26,158 - __main__ - INFO - Final retry count for call_id bc7815e3-04da-4a6c-84c3-0ef6f2165f1e: 3
2026-01-31 12:11:26,158 - __main__ - INFO - scheduled_at: 2026-01-31 18:00:00+04:00, buffer_until: 2026-01-31 18:15:00+04:00
2026-01-31 12:11:26,158 - __main__ - INFO - Saved booking to JSON: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\booking_f497b1d5_20260131_121126.json
2026-01-31 12:11:26,159 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 12:11:26,513 - db.storage.leads - DEBUG - Lead 15edc307-a954-4674-8be9-5b8876df9c11 already assigned or not found
2026-01-31 12:11:26,720 - db.storage.lead_bookings - ERROR - Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(734cd516-e252-4728-9c52-4663ee552653, 15edc307-a954-4674-8be9-5b8876df9c11, 2026-01-31 18:00:00, auto_followup) already exists.
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\db\storage\lead_bookings.py", line 377, in save_booking
    cur.execute(f"""
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(734cd516-e252-4728-9c52-4663ee552653, 15edc307-a954-4674-8be9-5b8876df9c11, 2026-01-31 18:00:00, auto_followup) already exists.

2026-01-31 12:11:26,722 - __main__ - WARNING - Skipped database save: Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(734cd516-e252-4728-9c52-4663ee552653, 15edc307-a954-4674-8be9-5b8876df9c11, 2026-01-31 18:00:00, auto_followup) already exists.

2026-01-31 12:11:26,937 - httpcore.connection - DEBUG - close.started
2026-01-31 12:11:26,937 - httpcore.connection - DEBUG - close.complete
2026-01-31 12:56:19,834 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 12:56:19,856 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 12:56:19,881 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 12:56:19,901 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 12:56:21,960 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 12:56:21,961 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 12:56:22,353 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 12:56:22,780 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 12:56:23,007 - __main__ - DEBUG - Parsed 11 segments from transcripts
2026-01-31 12:56:23,007 - __main__ - INFO - call_id from transcription: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, fallback to voice_call_logs.id: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, using: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9
2026-01-31 12:56:23,009 - __main__ - INFO - Extracting booking info from conversation (length: 1429 chars)
2026-01-31 12:56:23,009 - __main__ - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 12:56:23,009 - __main__ - INFO - Conversation length: 1429 chars
2026-01-31 12:56:23,009 - __main__ - DEBUG - Calling Gemini API with structured output: temperature=0.1, maxOutputTokens=4096
2026-01-31 12:56:23,012 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 12:56:23,128 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 12:56:23,131 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2026-01-31 12:56:23,154 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001D442C7F950>
2026-01-31 12:56:23,154 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001D443060CD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2026-01-31 12:56:23,169 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001D443054980>
2026-01-31 12:56:23,170 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 12:56:23,171 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 12:56:23,171 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 12:56:23,172 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 12:56:23,172 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 12:56:25,267 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 07:26:26 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=2088'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 12:56:25,268 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 12:56:25,269 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 12:56:25,269 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 12:56:25,269 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 12:56:25,270 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 12:56:25,271 - analysis.gemini_client - DEBUG - API finish_reason: FinishReason.STOP
2026-01-31 12:56:25,271 - analysis.gemini_client - DEBUG - Raw Gemini response (first 500 chars): {
"booking_type": "auto_followup",
"scheduled_at": "tomorrow 3 PM",
"student_grade": 10,
"call_id": "CALL-98765",
"has_future_discussion": true
}
2026-01-31 12:56:25,272 - analysis.gemini_client - DEBUG - Response length: 145 chars
2026-01-31 12:56:25,273 - __main__ - DEBUG - Booking extraction structured response received
2026-01-31 12:56:25,274 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': 'tomorrow 3 PM', 'student_grade': 10, 'call_id': 'CALL-98765'}
2026-01-31 12:56:25,561 - __main__ - WARNING - Booking already exists for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 - this is a duplicate call
2026-01-31 12:56:25,561 - __main__ - INFO - Student grade mentioned in conversation: Grade 10
2026-01-31 12:56:25,561 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 12:56:25,561 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 12:56:25,562 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-31 11:11:19+04:00 (GST)
2026-01-31 12:56:25,562 - __main__ - DEBUG - Call started at: 2026-01-31 11:10:53.413538+04:00, using transcription timestamp 2026-01-31 11:11:19+04:00 as reference for scheduling
2026-01-31 12:56:25,563 - __main__ - INFO - Time phrase 'tomorrow 3 PM' is CONFIRMED
2026-01-31 12:56:25,563 - __main__ - INFO - Time explicitly mentioned in conversation: 'tomorrow 3 PM' - using this time directly (no stage-based calculation)
2026-01-31 12:56:25,567 - __main__ - INFO - Found 'tomorrow' directly in scheduled_at_str: 'tomorrow 3 PM'
2026-01-31 12:56:25,578 - analysis.schedule_calculator - INFO - Extracted hour 15 from pattern '\b(\d{1,2})\s*(?:pm|p\.m\.)\b' in: tomorrow 3 pm
2026-01-31 12:56:25,578 - analysis.schedule_calculator - INFO - Using exact requested time: 15:00:00 (agent commitment, overriding working hours)
2026-01-31 12:56:25,579 - analysis.schedule_calculator - INFO - Callback absolute time 'tomorrow 3 pm' parsed to: 2026-02-01 15:00:00+04:00
2026-01-31 12:56:25,580 - __main__ - INFO - Extracted explicit time from original string 'tomorrow 3 PM': 15:00
2026-01-31 12:56:25,581 - __main__ - INFO - Using explicit parsed date and time: 2026-02-01 at 15:00:00 = 2026-02-01 15:00:00+04:00
2026-01-31 12:56:26,839 - __main__ - WARNING - Duplicate call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 detected, but retry_count based on lead_id and booking_type
2026-01-31 12:56:26,840 - __main__ - INFO - Existing bookings for lead_id b6e38c17-0861-4546-be1a-9fd4cddb2e40 and booking_type auto_followup: 159
2026-01-31 12:56:26,840 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 158
2026-01-31 12:56:26,841 - __main__ - INFO - retry_count = 159 (max_retry_count + 1)
2026-01-31 12:56:26,841 - __main__ - INFO - parent_booking_id = 04567e73-f80a-40c9-a3b7-8e0e49661451 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 12:56:26,841 - __main__ - INFO - Final retry count for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9: 159
2026-01-31 12:56:26,841 - __main__ - INFO - scheduled_at: 2026-02-01 15:00:00+04:00, buffer_until: 2026-02-01 15:15:00+04:00
2026-01-31 12:56:26,841 - __main__ - DEBUG - JSON file saving disabled for call_log_id=04567e73-f80a-40c9-a3b7-8e0e49661451
2026-01-31 12:56:26,842 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 12:56:26,842 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 12:56:27,065 - db.storage.leads - DEBUG - Lead b6e38c17-0861-4546-be1a-9fd4cddb2e40 already assigned or not found
2026-01-31 12:56:27,296 - __main__ - INFO - Saved booking to database: 6ac40188-54e0-4388-af19-b01933a59fc7
2026-01-31 12:56:27,460 - httpcore.connection - DEBUG - close.started
2026-01-31 12:56:27,461 - httpcore.connection - DEBUG - close.complete
2026-01-31 12:57:19,359 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 12:57:19,381 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 12:57:19,405 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 12:57:19,428 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 12:57:21,206 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 12:57:21,206 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 12:57:21,581 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 12:57:22,228 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 12:57:22,505 - __main__ - DEBUG - Parsed 11 segments from transcripts
2026-01-31 12:57:22,506 - __main__ - INFO - call_id from transcription: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, fallback to voice_call_logs.id: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, using: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9
2026-01-31 12:57:22,507 - __main__ - INFO - Extracting booking info from conversation (length: 1429 chars)
2026-01-31 12:57:22,509 - __main__ - INFO - Calling Gemini API for booking extraction
2026-01-31 12:57:22,510 - __main__ - INFO - Conversation length: 1429 chars
2026-01-31 12:57:22,511 - __main__ - DEBUG - Sending payload to Gemini API: temperature=0.1, maxOutputTokens=4096
2026-01-31 12:57:22,512 - __main__ - DEBUG - Prompt length: 3659 characters
2026-01-31 12:57:22,513 - __main__ - DEBUG - Prompt preview (first 500 chars): Analyze this conversation and extract booking information.

CONVERSATION:
Agent: Hi there, this is Nithya from Sasya Spaces... um, Dubai. Am I speaking with Pavan?
User: Yes.
User: I'm
Agent: Right, Pavan... so, you'd shown interest in Dubai property recently, right? I just wanted to follow upare you still, like, exploring options?
User: Yeah. I am exploring. Still, I am exploring.
Agent: Okay, good to know. I mean, honestly, since we last spoke, the pipeline has been moving really fast for inv...
2026-01-31 12:57:22,641 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=60.0 socket_options=None
2026-01-31 12:57:22,656 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001C061F7CDA0>
2026-01-31 12:57:22,658 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C062F3FF50> server_hostname='generativelanguage.googleapis.com' timeout=60.0
2026-01-31 12:57:22,675 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001C062DB7680>
2026-01-31 12:57:22,676 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 12:57:22,676 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 12:57:22,676 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 12:57:22,678 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 12:57:22,678 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 12:57:22,793 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Type', b'application/json; charset=UTF-8'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 07:27:23 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=102'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 12:57:22,794 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=AIzaSyDxruz-f5r8BfNYzzTBWwswoBZHVwI8orA "HTTP/1.1 404 Not Found"
2026-01-31 12:57:22,795 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 12:57:22,796 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 12:57:22,797 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 12:57:22,797 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 12:57:22,798 - httpcore.connection - DEBUG - close.started
2026-01-31 12:57:22,798 - httpcore.connection - DEBUG - close.complete
2026-01-31 12:57:22,798 - __main__ - ERROR - Gemini API HTTP error 404: Client error '404 Not Found' for url 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=AIzaSyDxruz-f5r8BfNYzzTBWwswoBZHVwI8orA'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2026-01-31 12:57:22,799 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': None, 'student_grade': None, 'call_id': None}
2026-01-31 12:57:23,130 - __main__ - WARNING - Booking already exists for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 - this is a duplicate call
2026-01-31 12:57:23,130 - __main__ - INFO - Student grade not mentioned in conversation, will use default Grade 12+ timeline
2026-01-31 12:57:23,132 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 12:57:23,132 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 12:57:23,132 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-31 11:11:19+04:00 (GST)
2026-01-31 12:57:23,133 - __main__ - DEBUG - Call started at: 2026-01-31 11:10:53.413538+04:00, using transcription timestamp 2026-01-31 11:11:19+04:00 as reference for scheduling
2026-01-31 12:57:23,138 - __main__ - INFO - Extracted time from conversation using pattern #5 '(?:^|[.\s,\'"])(?:after|in|within)\s+(\d+)(?:\s|\....': 'after 2027 mins'
2026-01-31 12:57:23,138 - __main__ - INFO - Extracted time from conversation text (fallback): 'after 2027 mins'
2026-01-31 12:57:23,139 - __main__ - INFO - Fallback extraction found relative time 'after 2027 mins' - treating as CONFIRMED
2026-01-31 12:57:23,139 - __main__ - INFO - Time explicitly mentioned in conversation: 'after 2027 mins' - using this time directly (no stage-based calculation)
2026-01-31 12:57:23,144 - __main__ - INFO - Using last transcription timestamp (reference_time) as base for relative time: 2026-01-31 11:11:19+04:00
2026-01-31 12:57:23,144 - __main__ - INFO - Relative time (same day): 'after 2027 mins' = 2026-01-31 11:11:19+04:00 + 2027 minutes = 2026-02-01 20:58:19+04:00
2026-01-31 12:57:24,531 - __main__ - WARNING - Duplicate call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 detected, but retry_count based on lead_id and booking_type
2026-01-31 12:57:24,531 - __main__ - INFO - Existing bookings for lead_id b6e38c17-0861-4546-be1a-9fd4cddb2e40 and booking_type auto_followup: 160
2026-01-31 12:57:24,532 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 159
2026-01-31 12:57:24,532 - __main__ - INFO - retry_count = 160 (max_retry_count + 1)
2026-01-31 12:57:24,532 - __main__ - INFO - parent_booking_id = 04567e73-f80a-40c9-a3b7-8e0e49661451 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 12:57:24,532 - __main__ - INFO - Final retry count for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9: 160
2026-01-31 12:57:24,532 - __main__ - INFO - scheduled_at: 2026-02-01 20:58:19+04:00, buffer_until: 2026-02-01 21:13:19+04:00
2026-01-31 12:57:24,533 - __main__ - DEBUG - JSON file saving disabled for call_log_id=04567e73-f80a-40c9-a3b7-8e0e49661451
2026-01-31 12:57:24,534 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 12:57:24,534 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 12:57:24,797 - db.storage.leads - DEBUG - Lead b6e38c17-0861-4546-be1a-9fd4cddb2e40 already assigned or not found
2026-01-31 12:57:25,065 - db.storage.lead_bookings - ERROR - Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-02-01 20:58:00, auto_followup) already exists.
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\db\storage\lead_bookings.py", line 377, in save_booking
    cur.execute(f"""
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-02-01 20:58:00, auto_followup) already exists.

2026-01-31 12:57:25,076 - __main__ - WARNING - Skipped database save: Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-02-01 20:58:00, auto_followup) already exists.

2026-01-31 13:01:22,817 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:01:22,839 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:01:22,861 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:01:22,883 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:01:24,580 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:01:24,582 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 13:01:25,042 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 13:01:25,510 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 13:01:25,757 - __main__ - DEBUG - Parsed 11 segments from transcripts
2026-01-31 13:01:25,758 - __main__ - INFO - call_id from transcription: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, fallback to voice_call_logs.id: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, using: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9
2026-01-31 13:01:25,758 - __main__ - INFO - Extracting booking info from conversation (length: 1429 chars)
2026-01-31 13:01:25,758 - __main__ - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 13:01:25,759 - __main__ - INFO - Conversation length: 1429 chars
2026-01-31 13:01:25,760 - __main__ - DEBUG - Calling Gemini API with structured output: temperature=0.1, maxOutputTokens=4096
2026-01-31 13:01:25,763 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 13:01:25,922 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:01:25,926 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2026-01-31 13:01:25,950 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000200CFF40A40>
2026-01-31 13:01:25,950 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000200CFE70CD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2026-01-31 13:01:25,972 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000200CFEE9B20>
2026-01-31 13:01:25,972 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 13:01:25,973 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 13:01:25,973 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 13:01:25,975 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 13:01:25,975 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 13:01:27,783 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 07:31:28 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1801'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 13:01:27,784 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:01:27,785 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 13:01:27,786 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 13:01:27,786 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 13:01:27,786 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 13:01:27,788 - analysis.gemini_client - DEBUG - API finish_reason: FinishReason.STOP
2026-01-31 13:01:27,788 - analysis.gemini_client - DEBUG - Raw Gemini response (first 500 chars): {
"booking_type": "auto_followup",
"scheduled_at": "null",
"student_grade": 12,
"call_id": "null",
"has_future_discussion": false
}
2026-01-31 13:01:27,788 - analysis.gemini_client - DEBUG - Response length: 131 chars
2026-01-31 13:01:27,792 - __main__ - DEBUG - Booking extraction structured response received
2026-01-31 13:01:27,792 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': 'null', 'student_grade': 12, 'call_id': 'null'}
2026-01-31 13:01:28,101 - __main__ - WARNING - Booking already exists for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 - this is a duplicate call
2026-01-31 13:01:28,101 - __main__ - INFO - Student grade mentioned in conversation: Grade 12
2026-01-31 13:01:28,103 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:01:28,103 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:01:28,103 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-31 11:11:19+04:00 (GST)
2026-01-31 13:01:28,103 - __main__ - DEBUG - Call started at: 2026-01-31 11:10:53.413538+04:00, using transcription timestamp 2026-01-31 11:11:19+04:00 as reference for scheduling
2026-01-31 13:01:28,104 - __main__ - INFO - Time phrase 'null' is CONFIRMED
2026-01-31 13:01:28,104 - __main__ - INFO - Time explicitly mentioned in conversation: 'null' - using this time directly (no stage-based calculation)
2026-01-31 13:01:28,132 - analysis.schedule_calculator - INFO - Using exact requested time: 11:11:19 (agent commitment, overriding working hours)
2026-01-31 13:01:28,133 - analysis.schedule_calculator - INFO - Callback absolute time 'null' parsed to: 2026-01-31 11:11:19+04:00
2026-01-31 13:01:28,134 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:01:28,135 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:01:28,135 - __main__ - INFO - Using first transcription timestamp date for relative time: 2026-01-31
2026-01-31 13:01:28,135 - __main__ - INFO - Combined target date (2026-01-31) with schedule_calculator time (11:11) = 2026-01-31 11:11:00+04:00
2026-01-31 13:01:29,457 - __main__ - WARNING - Duplicate call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 detected, but retry_count based on lead_id and booking_type
2026-01-31 13:01:29,457 - __main__ - INFO - Existing bookings for lead_id b6e38c17-0861-4546-be1a-9fd4cddb2e40 and booking_type auto_followup: 160
2026-01-31 13:01:29,458 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 159
2026-01-31 13:01:29,458 - __main__ - INFO - retry_count = 160 (max_retry_count + 1)
2026-01-31 13:01:29,458 - __main__ - INFO - parent_booking_id = 04567e73-f80a-40c9-a3b7-8e0e49661451 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 13:01:29,458 - __main__ - INFO - Final retry count for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9: 160
2026-01-31 13:01:29,459 - __main__ - INFO - scheduled_at: 2026-01-31 11:11:00+04:00, buffer_until: 2026-01-31 11:26:00+04:00
2026-01-31 13:01:29,459 - __main__ - DEBUG - JSON file saving disabled for call_log_id=04567e73-f80a-40c9-a3b7-8e0e49661451
2026-01-31 13:01:29,459 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 13:01:29,459 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:01:29,701 - db.storage.leads - DEBUG - Lead b6e38c17-0861-4546-be1a-9fd4cddb2e40 already assigned or not found
2026-01-31 13:01:29,947 - db.storage.lead_bookings - ERROR - Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\db\storage\lead_bookings.py", line 377, in save_booking
    cur.execute(f"""
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.

2026-01-31 13:01:29,953 - __main__ - WARNING - Skipped database save: Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.

2026-01-31 13:01:30,137 - httpcore.connection - DEBUG - close.started
2026-01-31 13:01:30,138 - httpcore.connection - DEBUG - close.complete
2026-01-31 13:01:44,118 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:01:44,140 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:01:44,163 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:01:44,185 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:01:45,886 - __main__ - INFO - DEBUG logging enabled - will show Gemini API payload details
2026-01-31 13:01:45,886 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:01:45,887 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 13:01:46,317 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 13:01:46,708 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 13:01:46,937 - __main__ - DEBUG - Parsed 11 segments from transcripts
2026-01-31 13:01:46,937 - __main__ - INFO - call_id from transcription: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, fallback to voice_call_logs.id: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, using: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9
2026-01-31 13:01:46,937 - __main__ - INFO - Extracting booking info from conversation (length: 1429 chars)
2026-01-31 13:01:46,937 - __main__ - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 13:01:46,938 - __main__ - INFO - Conversation length: 1429 chars
2026-01-31 13:01:46,938 - __main__ - DEBUG - Calling Gemini API with structured output: temperature=0.1, maxOutputTokens=4096
2026-01-31 13:01:46,940 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 13:01:47,054 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:01:47,056 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2026-01-31 13:01:47,069 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001DC2BFE0C50>
2026-01-31 13:01:47,069 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001DC2BF10CD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2026-01-31 13:01:47,084 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001DC2BFE0BC0>
2026-01-31 13:01:47,085 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 13:01:47,086 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 13:01:47,086 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 13:01:47,086 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 13:01:47,087 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 13:01:48,748 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 07:31:49 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1655'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 13:01:48,751 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:01:48,752 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 13:01:48,753 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 13:01:48,753 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 13:01:48,753 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 13:01:48,755 - analysis.gemini_client - DEBUG - API finish_reason: FinishReason.STOP
2026-01-31 13:01:48,755 - analysis.gemini_client - DEBUG - Raw Gemini response (first 500 chars): {
"booking_type": "auto_followup",
"scheduled_at": "tomorrow 3 PM",
"student_grade": 11,
"call_id": "CALL-98765",
"has_future_discussion": true
}
2026-01-31 13:01:48,755 - analysis.gemini_client - DEBUG - Response length: 145 chars
2026-01-31 13:01:48,758 - __main__ - DEBUG - Booking extraction structured response received
2026-01-31 13:01:48,758 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': 'tomorrow 3 PM', 'student_grade': 11, 'call_id': 'CALL-98765'}
2026-01-31 13:01:49,041 - __main__ - WARNING - Booking already exists for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 - this is a duplicate call
2026-01-31 13:01:49,042 - __main__ - INFO - Student grade mentioned in conversation: Grade 11
2026-01-31 13:01:49,042 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:01:49,042 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:01:49,043 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-31 11:11:19+04:00 (GST)
2026-01-31 13:01:49,043 - __main__ - DEBUG - Call started at: 2026-01-31 11:10:53.413538+04:00, using transcription timestamp 2026-01-31 11:11:19+04:00 as reference for scheduling
2026-01-31 13:01:49,043 - __main__ - INFO - Time phrase 'tomorrow 3 PM' is CONFIRMED
2026-01-31 13:01:49,043 - __main__ - INFO - Time explicitly mentioned in conversation: 'tomorrow 3 PM' - using this time directly (no stage-based calculation)
2026-01-31 13:01:49,047 - __main__ - INFO - Found 'tomorrow' directly in scheduled_at_str: 'tomorrow 3 PM'
2026-01-31 13:01:49,056 - analysis.schedule_calculator - INFO - Extracted hour 15 from pattern '\b(\d{1,2})\s*(?:pm|p\.m\.)\b' in: tomorrow 3 pm
2026-01-31 13:01:49,056 - analysis.schedule_calculator - INFO - Using exact requested time: 15:00:00 (agent commitment, overriding working hours)
2026-01-31 13:01:49,058 - analysis.schedule_calculator - INFO - Callback absolute time 'tomorrow 3 pm' parsed to: 2026-02-01 15:00:00+04:00
2026-01-31 13:01:49,058 - __main__ - INFO - Extracted explicit time from original string 'tomorrow 3 PM': 15:00
2026-01-31 13:01:49,058 - __main__ - INFO - Using explicit parsed date and time: 2026-02-01 at 15:00:00 = 2026-02-01 15:00:00+04:00
2026-01-31 13:01:50,198 - __main__ - WARNING - Duplicate call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 detected, but retry_count based on lead_id and booking_type
2026-01-31 13:01:50,198 - __main__ - INFO - Existing bookings for lead_id b6e38c17-0861-4546-be1a-9fd4cddb2e40 and booking_type auto_followup: 160
2026-01-31 13:01:50,198 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 159
2026-01-31 13:01:50,199 - __main__ - INFO - retry_count = 160 (max_retry_count + 1)
2026-01-31 13:01:50,200 - __main__ - INFO - parent_booking_id = 04567e73-f80a-40c9-a3b7-8e0e49661451 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 13:01:50,201 - __main__ - INFO - Final retry count for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9: 160
2026-01-31 13:01:50,202 - __main__ - INFO - scheduled_at: 2026-02-01 15:00:00+04:00, buffer_until: 2026-02-01 15:15:00+04:00
2026-01-31 13:01:50,202 - __main__ - DEBUG - JSON file saving disabled for call_log_id=04567e73-f80a-40c9-a3b7-8e0e49661451
2026-01-31 13:01:50,203 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 13:01:50,203 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:01:50,428 - db.storage.leads - DEBUG - Lead b6e38c17-0861-4546-be1a-9fd4cddb2e40 already assigned or not found
2026-01-31 13:01:50,752 - db.storage.lead_bookings - ERROR - Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-02-01 15:00:00, auto_followup) already exists.
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\db\storage\lead_bookings.py", line 377, in save_booking
    cur.execute(f"""
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-02-01 15:00:00, auto_followup) already exists.

2026-01-31 13:01:50,753 - __main__ - WARNING - Skipped database save: Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-02-01 15:00:00, auto_followup) already exists.

2026-01-31 13:01:50,908 - httpcore.connection - DEBUG - close.started
2026-01-31 13:01:50,909 - httpcore.connection - DEBUG - close.complete
2026-01-31 13:02:29,403 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:02:29,427 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:02:29,448 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:02:29,470 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:02:31,124 - __main__ - INFO - Fetching call from database (ID: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9)
2026-01-31 13:02:31,804 - __main__ - INFO - Call ID: DB_9399cef1-5023-4eb1-9c97-0bdd2a4f43c9_20260131_071053, Duration: 140s, Started: 2026-01-31 07:10:53.413538+00:00, Ended: 2026-01-31 07:13:14.306296+00:00
2026-01-31 13:02:31,805 - __main__ - INFO - Analyzing call DB_9399cef1-5023-4eb1-9c97-0bdd2a4f43c9_20260131_071053...
2026-01-31 13:02:31,805 - __main__ - INFO - Parsed 11 total messages from voiceagent format (6 user, 5 agent, filtered from 11 total segments)
2026-01-31 13:02:31,805 - __main__ - INFO - Processing call - Word count: 245, Duration: 140s, Text length: 1419 chars
2026-01-31 13:02:31,806 - __main__ - INFO - Step 1/7: Analyzing sentiment...
2026-01-31 13:02:31,806 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 13:02:31,930 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:02:33,739 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:02:33,743 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:02:41,687 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:02:41,689 - __main__ - INFO - Step 2/7: Generating summary...
2026-01-31 13:02:41,689 - __main__ - INFO - Starting summary generation...
2026-01-31 13:02:41,689 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:02:53,550 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:02:53,554 - __main__ - INFO - Summary generation complete - Key points: 5, Questions: 0
2026-01-31 13:02:53,554 - __main__ - INFO - Step 3/7: Determining lead disposition...
2026-01-31 13:02:53,555 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:03:01,905 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:03:01,917 - __main__ - INFO - Lead disposition: PROCEED IMMEDIATELY - Action: Deliver the requested brochures, floor plans, and ROI comparison immediately and follow up within 24 hours to address his analytical requirements.
2026-01-31 13:03:01,919 - __main__ - INFO - Step 4/7: Calculating lead score from disposition...
2026-01-31 13:03:01,920 - __main__ - INFO - Lead score: 10.0/10 - Category: Hot Lead
2026-01-31 13:03:01,920 - __main__ - INFO - Step 5/7: Calculating quality metrics...
2026-01-31 13:03:01,922 - __main__ - INFO - Step 6/7: Extracting call stages...
2026-01-31 13:03:01,923 - __main__ - INFO - Step 7/7: Extracting lead information...
2026-01-31 13:03:01,924 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:03:04,746 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:03:04,748 - analysis.lead_info_extractor - INFO - Lead info extracted: 7 fields
2026-01-31 13:03:04,748 - analysis.lead_info_extractor - INFO - Lead info saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_DB_9399c_20260131_130304.json
2026-01-31 13:03:04,750 - __main__ - INFO - Lead info extracted: 7 fields, saved to: D:\vonage\vonage-voice-agent\v2\analysis\json_exports\lead_info_DB_9399c_20260131_130304.json
2026-01-31 13:03:04,750 - __main__ - INFO - LLM cost for this call: $0.000000 (0 tokens)
2026-01-31 13:03:04,750 - __main__ - INFO - Call analysis complete - Call ID: DB_9399cef1-5023-4eb1-9c97-0bdd2a4f43c9_20260131_071053, Lead Score: 10.0/10, Disposition: PROCEED IMMEDIATELY
2026-01-31 13:03:04,751 - __main__ - INFO - Saving analytics to lad_dev.voice_call_analysis table...
2026-01-31 13:03:05,639 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 13:03:06,125 - __main__ - INFO - Analytics saved to lad_dev.voice_call_analysis (id=ca7527a8-6198-412d-a7a0-addf5e8859f1)
2026-01-31 13:03:06,618 - __main__ - INFO - Updated tags column in leads table (lead_id: b6e38c17-0861-4546-be1a-9fd4cddb2e40, tags: ['Hot Lead'])
2026-01-31 13:03:06,619 - __main__ - INFO - Analytics saved to database successfully!
2026-01-31 13:03:06,621 - __main__ - INFO - Analysis saved to: transcript_check.json
2026-01-31 13:06:42,496 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:06:42,521 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:06:42,550 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:06:42,583 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:06:44,266 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:06:44,266 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 13:06:44,643 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 13:06:45,034 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 13:06:45,268 - __main__ - DEBUG - Parsed 11 segments from transcripts
2026-01-31 13:06:45,271 - __main__ - INFO - call_id from transcription: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, fallback to voice_call_logs.id: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, using: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9
2026-01-31 13:06:45,272 - __main__ - INFO - Extracting booking info from conversation (length: 1429 chars)
2026-01-31 13:06:45,279 - __main__ - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 13:06:45,280 - __main__ - INFO - Conversation length: 1429 chars
2026-01-31 13:06:45,280 - __main__ - DEBUG - Calling Gemini API with structured output: temperature=0.1, maxOutputTokens=4096
2026-01-31 13:06:45,304 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 13:06:45,449 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:06:45,452 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2026-01-31 13:06:45,476 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000167B03E44A0>
2026-01-31 13:06:45,476 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000167B08F0CD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2026-01-31 13:06:45,494 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000167B08E4A10>
2026-01-31 13:06:45,494 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 13:06:45,494 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 13:06:45,495 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 13:06:45,496 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 13:06:45,496 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 13:06:47,362 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 07:36:48 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1858'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 13:06:47,363 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:06:47,363 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 13:06:47,363 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 13:06:47,365 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 13:06:47,365 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 13:06:47,366 - analysis.gemini_client - DEBUG - API finish_reason: FinishReason.STOP
2026-01-31 13:06:47,366 - analysis.gemini_client - DEBUG - Raw Gemini response (first 500 chars): {
"booking_type": "auto_followup",
"scheduled_at": "null",
"student_grade": 12,
"call_id": "null",
"has_future_discussion": false
}
2026-01-31 13:06:47,366 - analysis.gemini_client - DEBUG - Response length: 131 chars
2026-01-31 13:06:47,368 - __main__ - DEBUG - Booking extraction structured response received
2026-01-31 13:06:47,369 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': 'null', 'student_grade': 12, 'call_id': 'null'}
2026-01-31 13:06:47,640 - __main__ - WARNING - Booking already exists for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 - this is a duplicate call
2026-01-31 13:06:47,640 - __main__ - INFO - Student grade mentioned in conversation: Grade 12
2026-01-31 13:06:47,640 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:06:47,640 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:06:47,640 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-31 11:11:19+04:00 (GST)
2026-01-31 13:06:47,640 - __main__ - DEBUG - Call started at: 2026-01-31 11:10:53.413538+04:00, using transcription timestamp 2026-01-31 11:11:19+04:00 as reference for scheduling
2026-01-31 13:06:47,640 - __main__ - INFO - Time phrase 'null' is CONFIRMED
2026-01-31 13:06:47,640 - __main__ - INFO - Time explicitly mentioned in conversation: 'null' - using this time directly (no stage-based calculation)
2026-01-31 13:06:47,654 - analysis.schedule_calculator - INFO - Using exact requested time: 11:11:19 (agent commitment, overriding working hours)
2026-01-31 13:06:47,654 - analysis.schedule_calculator - INFO - Callback absolute time 'null' parsed to: 2026-01-31 11:11:19+04:00
2026-01-31 13:06:47,657 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:06:47,657 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:06:47,657 - __main__ - INFO - Using first transcription timestamp date for relative time: 2026-01-31
2026-01-31 13:06:47,658 - __main__ - INFO - Combined target date (2026-01-31) with schedule_calculator time (11:11) = 2026-01-31 11:11:00+04:00
2026-01-31 13:06:49,175 - __main__ - WARNING - Duplicate call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 detected, but retry_count based on lead_id and booking_type
2026-01-31 13:06:49,176 - __main__ - INFO - Existing bookings for lead_id b6e38c17-0861-4546-be1a-9fd4cddb2e40 and booking_type auto_followup: 160
2026-01-31 13:06:49,176 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 159
2026-01-31 13:06:49,176 - __main__ - INFO - retry_count = 160 (max_retry_count + 1)
2026-01-31 13:06:49,176 - __main__ - INFO - parent_booking_id = 04567e73-f80a-40c9-a3b7-8e0e49661451 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 13:06:49,176 - __main__ - INFO - Final retry count for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9: 160
2026-01-31 13:06:49,177 - __main__ - INFO - scheduled_at: 2026-01-31 11:11:00+04:00, buffer_until: 2026-01-31 11:26:00+04:00
2026-01-31 13:06:49,177 - __main__ - DEBUG - JSON file saving disabled for call_log_id=04567e73-f80a-40c9-a3b7-8e0e49661451
2026-01-31 13:06:49,178 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 13:06:49,178 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:06:49,393 - db.storage.leads - DEBUG - Lead b6e38c17-0861-4546-be1a-9fd4cddb2e40 already assigned or not found
2026-01-31 13:06:49,623 - db.storage.lead_bookings - ERROR - Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\db\storage\lead_bookings.py", line 377, in save_booking
    cur.execute(f"""
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.

2026-01-31 13:06:49,624 - __main__ - WARNING - Skipped database save: Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.

2026-01-31 13:06:49,772 - httpcore.connection - DEBUG - close.started
2026-01-31 13:06:49,773 - httpcore.connection - DEBUG - close.complete
2026-01-31 13:07:18,372 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:07:18,402 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:07:18,425 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:07:18,447 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:07:20,208 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:07:20,208 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 13:07:20,667 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 13:07:21,101 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 13:07:21,336 - __main__ - DEBUG - Parsed 11 segments from transcripts
2026-01-31 13:07:21,337 - __main__ - INFO - call_id from transcription: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, fallback to voice_call_logs.id: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, using: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9
2026-01-31 13:07:21,338 - __main__ - INFO - Extracting booking info from conversation (length: 1429 chars)
2026-01-31 13:07:21,339 - __main__ - INFO - Calling Gemini API for booking extraction
2026-01-31 13:07:21,340 - __main__ - INFO - Conversation length: 1429 chars
2026-01-31 13:07:21,340 - __main__ - DEBUG - Sending payload to Gemini API: temperature=0.1, maxOutputTokens=4096
2026-01-31 13:07:21,340 - __main__ - DEBUG - Prompt length: 3659 characters
2026-01-31 13:07:21,340 - __main__ - DEBUG - Prompt preview (first 500 chars): Analyze this conversation and extract booking information.

CONVERSATION:
Agent: Hi there, this is Nithya from Sasya Spaces... um, Dubai. Am I speaking with Pavan?
User: Yes.
User: I'm
Agent: Right, Pavan... so, you'd shown interest in Dubai property recently, right? I just wanted to follow upare you still, like, exploring options?
User: Yeah. I am exploring. Still, I am exploring.
Agent: Okay, good to know. I mean, honestly, since we last spoke, the pipeline has been moving really fast for inv...
2026-01-31 13:07:21,426 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=60.0 socket_options=None
2026-01-31 13:07:21,444 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000019209E70860>
2026-01-31 13:07:21,446 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001920A297ED0> server_hostname='generativelanguage.googleapis.com' timeout=60.0
2026-01-31 13:07:21,472 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x00000192776C36E0>
2026-01-31 13:07:21,473 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 13:07:21,475 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 13:07:21,475 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 13:07:21,476 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 13:07:21,476 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 13:07:21,598 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Type', b'application/json; charset=UTF-8'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 07:37:22 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=116'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 13:07:21,599 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=AIzaSyDxruz-f5r8BfNYzzTBWwswoBZHVwI8orA "HTTP/1.1 404 Not Found"
2026-01-31 13:07:21,600 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 13:07:21,601 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 13:07:21,602 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 13:07:21,602 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 13:07:21,603 - httpcore.connection - DEBUG - close.started
2026-01-31 13:07:21,603 - httpcore.connection - DEBUG - close.complete
2026-01-31 13:07:21,604 - __main__ - ERROR - Gemini API HTTP error 404: Client error '404 Not Found' for url 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=AIzaSyDxruz-f5r8BfNYzzTBWwswoBZHVwI8orA'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2026-01-31 13:07:21,604 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': None, 'student_grade': None, 'call_id': None}
2026-01-31 13:07:21,898 - __main__ - WARNING - Booking already exists for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 - this is a duplicate call
2026-01-31 13:07:21,898 - __main__ - INFO - Student grade not mentioned in conversation, will use default Grade 12+ timeline
2026-01-31 13:07:21,899 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:07:21,899 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:07:21,900 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-31 11:11:19+04:00 (GST)
2026-01-31 13:07:21,900 - __main__ - DEBUG - Call started at: 2026-01-31 11:10:53.413538+04:00, using transcription timestamp 2026-01-31 11:11:19+04:00 as reference for scheduling
2026-01-31 13:07:21,903 - __main__ - INFO - Extracted time from conversation using pattern #5 '(?:^|[.\s,\'"])(?:after|in|within)\s+(\d+)(?:\s|\....': 'after 2027 mins'
2026-01-31 13:07:21,904 - __main__ - INFO - Extracted time from conversation text (fallback): 'after 2027 mins'
2026-01-31 13:07:21,905 - __main__ - INFO - Fallback extraction found relative time 'after 2027 mins' - treating as CONFIRMED
2026-01-31 13:07:21,905 - __main__ - INFO - Time explicitly mentioned in conversation: 'after 2027 mins' - using this time directly (no stage-based calculation)
2026-01-31 13:07:21,911 - __main__ - INFO - Using last transcription timestamp (reference_time) as base for relative time: 2026-01-31 11:11:19+04:00
2026-01-31 13:07:21,911 - __main__ - INFO - Relative time (same day): 'after 2027 mins' = 2026-01-31 11:11:19+04:00 + 2027 minutes = 2026-02-01 20:58:19+04:00
2026-01-31 13:07:23,111 - __main__ - WARNING - Duplicate call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 detected, but retry_count based on lead_id and booking_type
2026-01-31 13:07:23,112 - __main__ - INFO - Existing bookings for lead_id b6e38c17-0861-4546-be1a-9fd4cddb2e40 and booking_type auto_followup: 160
2026-01-31 13:07:23,112 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 159
2026-01-31 13:07:23,112 - __main__ - INFO - retry_count = 160 (max_retry_count + 1)
2026-01-31 13:07:23,112 - __main__ - INFO - parent_booking_id = 04567e73-f80a-40c9-a3b7-8e0e49661451 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 13:07:23,112 - __main__ - INFO - Final retry count for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9: 160
2026-01-31 13:07:23,113 - __main__ - INFO - scheduled_at: 2026-02-01 20:58:19+04:00, buffer_until: 2026-02-01 21:13:19+04:00
2026-01-31 13:07:23,113 - __main__ - DEBUG - JSON file saving disabled for call_log_id=04567e73-f80a-40c9-a3b7-8e0e49661451
2026-01-31 13:07:23,113 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 13:07:23,113 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:07:23,341 - db.storage.leads - DEBUG - Lead b6e38c17-0861-4546-be1a-9fd4cddb2e40 already assigned or not found
2026-01-31 13:07:23,574 - db.storage.lead_bookings - ERROR - Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-02-01 20:58:00, auto_followup) already exists.
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\db\storage\lead_bookings.py", line 377, in save_booking
    cur.execute(f"""
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-02-01 20:58:00, auto_followup) already exists.

2026-01-31 13:07:23,576 - __main__ - WARNING - Skipped database save: Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-02-01 20:58:00, auto_followup) already exists.

2026-01-31 13:08:43,162 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:08:43,184 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:08:43,208 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:08:43,235 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:08:45,037 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:08:45,037 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 13:08:45,421 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 13:08:45,785 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 13:08:45,992 - __main__ - DEBUG - Parsed 11 segments from transcripts
2026-01-31 13:08:45,993 - __main__ - INFO - call_id from transcription: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, fallback to voice_call_logs.id: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, using: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9
2026-01-31 13:08:45,993 - __main__ - INFO - Extracting booking info from conversation (length: 1429 chars)
2026-01-31 13:08:45,993 - __main__ - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 13:08:45,993 - __main__ - INFO - Conversation length: 1429 chars
2026-01-31 13:08:45,993 - __main__ - DEBUG - Calling Gemini API with structured output: temperature=0.1, maxOutputTokens=4096
2026-01-31 13:08:45,996 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 13:08:46,222 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:08:46,257 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2026-01-31 13:08:46,272 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000275068B0E60>
2026-01-31 13:08:46,273 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000027506EFEAD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2026-01-31 13:08:46,289 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000275067AF620>
2026-01-31 13:08:46,290 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 13:08:46,290 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 13:08:46,290 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 13:08:46,290 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 13:08:46,292 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 13:08:48,310 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 07:38:49 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=2010'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 13:08:48,311 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:08:48,311 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 13:08:48,312 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 13:08:48,312 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 13:08:48,313 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 13:08:48,314 - analysis.gemini_client - DEBUG - API finish_reason: FinishReason.STOP
2026-01-31 13:08:48,314 - analysis.gemini_client - DEBUG - Raw Gemini response (first 500 chars): {
"booking_type": "auto_followup",
"scheduled_at": "null",
"student_grade": 12,
"call_id": "null",
"has_future_discussion": false
}
2026-01-31 13:08:48,314 - analysis.gemini_client - DEBUG - Response length: 131 chars
2026-01-31 13:08:48,317 - __main__ - DEBUG - Booking extraction structured response received
2026-01-31 13:08:48,317 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': 'null', 'student_grade': 12, 'call_id': 'null'}
2026-01-31 13:08:48,565 - __main__ - WARNING - Booking already exists for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 - this is a duplicate call
2026-01-31 13:08:48,565 - __main__ - INFO - Checking scheduled_at_str value: 'null'
2026-01-31 13:08:48,565 - __main__ - INFO - Student grade mentioned in conversation: Grade 12
2026-01-31 13:08:48,566 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:08:48,566 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:08:48,566 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-31 11:11:19+04:00 (GST)
2026-01-31 13:08:48,567 - __main__ - DEBUG - Call started at: 2026-01-31 11:10:53.413538+04:00, using transcription timestamp 2026-01-31 11:11:19+04:00 as reference for scheduling
2026-01-31 13:08:48,567 - __main__ - INFO - Time phrase 'null' is CONFIRMED
2026-01-31 13:08:48,567 - __main__ - INFO - Time explicitly mentioned in conversation: 'null' - using this time directly (no stage-based calculation)
2026-01-31 13:08:48,585 - analysis.schedule_calculator - INFO - Using exact requested time: 11:11:19 (agent commitment, overriding working hours)
2026-01-31 13:08:48,585 - analysis.schedule_calculator - INFO - Callback absolute time 'null' parsed to: 2026-01-31 11:11:19+04:00
2026-01-31 13:08:48,587 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:08:48,587 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:08:48,587 - __main__ - INFO - Using first transcription timestamp date for relative time: 2026-01-31
2026-01-31 13:08:48,588 - __main__ - INFO - Combined target date (2026-01-31) with schedule_calculator time (11:11) = 2026-01-31 11:11:00+04:00
2026-01-31 13:08:49,716 - __main__ - WARNING - Duplicate call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 detected, but retry_count based on lead_id and booking_type
2026-01-31 13:08:49,717 - __main__ - INFO - Existing bookings for lead_id b6e38c17-0861-4546-be1a-9fd4cddb2e40 and booking_type auto_followup: 160
2026-01-31 13:08:49,717 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 159
2026-01-31 13:08:49,718 - __main__ - INFO - retry_count = 160 (max_retry_count + 1)
2026-01-31 13:08:49,718 - __main__ - INFO - parent_booking_id = 04567e73-f80a-40c9-a3b7-8e0e49661451 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 13:08:49,718 - __main__ - INFO - Final retry count for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9: 160
2026-01-31 13:08:49,718 - __main__ - INFO - scheduled_at: 2026-01-31 11:11:00+04:00, buffer_until: 2026-01-31 11:26:00+04:00
2026-01-31 13:08:49,719 - __main__ - DEBUG - JSON file saving disabled for call_log_id=04567e73-f80a-40c9-a3b7-8e0e49661451
2026-01-31 13:08:49,719 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 13:08:49,719 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:08:49,910 - db.storage.leads - DEBUG - Lead b6e38c17-0861-4546-be1a-9fd4cddb2e40 already assigned or not found
2026-01-31 13:08:50,101 - db.storage.lead_bookings - ERROR - Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\db\storage\lead_bookings.py", line 377, in save_booking
    cur.execute(f"""
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.

2026-01-31 13:08:50,102 - __main__ - WARNING - Skipped database save: Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.

2026-01-31 13:08:50,252 - httpcore.connection - DEBUG - close.started
2026-01-31 13:08:50,253 - httpcore.connection - DEBUG - close.complete
2026-01-31 13:10:57,243 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:10:57,267 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:10:57,289 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:10:57,311 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:10:59,104 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:10:59,104 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 13:10:59,545 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 13:10:59,966 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 13:11:00,192 - __main__ - DEBUG - Parsed 11 segments from transcripts
2026-01-31 13:11:00,193 - __main__ - INFO - call_id from transcription: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, fallback to voice_call_logs.id: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, using: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9
2026-01-31 13:11:00,193 - __main__ - INFO - Extracting booking info from conversation (length: 1429 chars)
2026-01-31 13:11:00,193 - __main__ - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 13:11:00,194 - __main__ - INFO - Conversation length: 1429 chars
2026-01-31 13:11:00,194 - __main__ - DEBUG - Calling Gemini API with structured output: temperature=0.1, maxOutputTokens=4096
2026-01-31 13:11:00,198 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 13:11:00,334 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:11:00,335 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2026-01-31 13:11:00,348 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018CAECB1D60>
2026-01-31 13:11:00,348 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000018CAEE2EAD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2026-01-31 13:11:00,364 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C9C2A1310>
2026-01-31 13:11:00,365 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 13:11:00,366 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 13:11:00,366 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 13:11:00,367 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 13:11:00,367 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 13:11:01,891 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 07:41:02 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1516'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 13:11:01,891 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:11:01,893 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 13:11:01,893 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 13:11:01,893 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 13:11:01,893 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 13:11:01,895 - analysis.gemini_client - DEBUG - API finish_reason: FinishReason.STOP
2026-01-31 13:11:01,895 - analysis.gemini_client - DEBUG - Raw Gemini response (first 500 chars): {
"booking_type": "auto_followup",
"scheduled_at": "null",
"student_grade": 12,
"call_id": "null",
"has_future_discussion": false
}
2026-01-31 13:11:01,896 - analysis.gemini_client - DEBUG - Response length: 131 chars
2026-01-31 13:11:01,897 - __main__ - DEBUG - Booking extraction structured response received
2026-01-31 13:11:01,898 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': 'null', 'student_grade': 12, 'call_id': 'null'}
2026-01-31 13:11:02,180 - __main__ - WARNING - Booking already exists for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 - this is a duplicate call
2026-01-31 13:11:02,180 - __main__ - INFO - Student grade mentioned in conversation: Grade 12
2026-01-31 13:11:02,180 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:11:02,181 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:11:02,181 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-31 11:11:19+04:00 (GST)
2026-01-31 13:11:02,181 - __main__ - DEBUG - Call started at: 2026-01-31 11:10:53.413538+04:00, using transcription timestamp 2026-01-31 11:11:19+04:00 as reference for scheduling
2026-01-31 13:11:02,181 - __main__ - INFO - Time phrase 'null' is CONFIRMED
2026-01-31 13:11:02,182 - __main__ - INFO - Time explicitly mentioned in conversation: 'null' - using this time directly (no stage-based calculation)
2026-01-31 13:11:02,194 - analysis.schedule_calculator - INFO - Using exact requested time: 11:11:19 (agent commitment, overriding working hours)
2026-01-31 13:11:02,195 - analysis.schedule_calculator - INFO - Callback absolute time 'null' parsed to: 2026-01-31 11:11:19+04:00
2026-01-31 13:11:02,196 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:11:02,197 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:11:02,197 - __main__ - INFO - Using first transcription timestamp date for relative time: 2026-01-31
2026-01-31 13:11:02,197 - __main__ - INFO - Combined target date (2026-01-31) with schedule_calculator time (11:11) = 2026-01-31 11:11:00+04:00
2026-01-31 13:11:03,492 - __main__ - WARNING - Duplicate call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 detected, but retry_count based on lead_id and booking_type
2026-01-31 13:11:03,493 - __main__ - INFO - Existing bookings for lead_id b6e38c17-0861-4546-be1a-9fd4cddb2e40 and booking_type auto_followup: 160
2026-01-31 13:11:03,494 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 159
2026-01-31 13:11:03,495 - __main__ - INFO - retry_count = 160 (max_retry_count + 1)
2026-01-31 13:11:03,495 - __main__ - INFO - parent_booking_id = 04567e73-f80a-40c9-a3b7-8e0e49661451 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 13:11:03,495 - __main__ - INFO - Final retry count for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9: 160
2026-01-31 13:11:03,496 - __main__ - INFO - scheduled_at: 2026-01-31 11:11:00+04:00, buffer_until: 2026-01-31 11:26:00+04:00
2026-01-31 13:11:03,496 - __main__ - DEBUG - JSON file saving disabled for call_log_id=04567e73-f80a-40c9-a3b7-8e0e49661451
2026-01-31 13:11:03,497 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 13:11:03,498 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:11:03,724 - db.storage.leads - DEBUG - Lead b6e38c17-0861-4546-be1a-9fd4cddb2e40 already assigned or not found
2026-01-31 13:11:03,978 - db.storage.lead_bookings - ERROR - Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\db\storage\lead_bookings.py", line 377, in save_booking
    cur.execute(f"""
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.

2026-01-31 13:11:03,980 - __main__ - WARNING - Skipped database save: Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.

2026-01-31 13:11:04,149 - httpcore.connection - DEBUG - close.started
2026-01-31 13:11:04,149 - httpcore.connection - DEBUG - close.complete
2026-01-31 13:11:23,178 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:11:23,213 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:11:23,243 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:11:23,267 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:11:25,168 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:11:25,168 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 13:11:25,608 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 13:11:25,989 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 13:11:26,197 - __main__ - DEBUG - Parsed 11 segments from transcripts
2026-01-31 13:11:26,197 - __main__ - INFO - call_id from transcription: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, fallback to voice_call_logs.id: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, using: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9
2026-01-31 13:11:26,198 - __main__ - INFO - Extracting booking info from conversation (length: 1429 chars)
2026-01-31 13:11:26,198 - __main__ - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 13:11:26,198 - __main__ - INFO - Conversation length: 1429 chars
2026-01-31 13:11:26,198 - __main__ - DEBUG - Calling Gemini API with structured output: temperature=0.1, maxOutputTokens=4096
2026-01-31 13:11:26,199 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 13:11:26,317 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:11:26,319 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2026-01-31 13:11:26,339 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C67F181130>
2026-01-31 13:11:26,339 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C67F0B0CD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2026-01-31 13:11:26,354 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C66C6BFC50>
2026-01-31 13:11:26,354 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 13:11:26,355 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 13:11:26,355 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 13:11:26,355 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 13:11:26,355 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 13:11:28,117 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 07:41:28 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1755'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 13:11:28,118 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:11:28,118 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 13:11:28,118 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 13:11:28,118 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 13:11:28,119 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 13:11:28,120 - analysis.gemini_client - DEBUG - API finish_reason: FinishReason.STOP
2026-01-31 13:11:28,120 - analysis.gemini_client - DEBUG - Raw Gemini response (first 500 chars): {"booking_type":"auto_followup","scheduled_at":"null","student_grade":10,"call_id":"null","has_future_discussion":true}
2026-01-31 13:11:28,120 - analysis.gemini_client - DEBUG - Response length: 119 chars
2026-01-31 13:11:28,122 - __main__ - DEBUG - Booking extraction structured response received
2026-01-31 13:11:28,123 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': 'null', 'student_grade': 10, 'call_id': 'null'}
2026-01-31 13:11:28,385 - __main__ - WARNING - Booking already exists for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 - this is a duplicate call
2026-01-31 13:11:28,385 - __main__ - INFO - Student grade mentioned in conversation: Grade 10
2026-01-31 13:11:28,385 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:11:28,385 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:11:28,385 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-31 11:11:19+04:00 (GST)
2026-01-31 13:11:28,385 - __main__ - DEBUG - Call started at: 2026-01-31 11:10:53.413538+04:00, using transcription timestamp 2026-01-31 11:11:19+04:00 as reference for scheduling
2026-01-31 13:11:28,385 - __main__ - INFO - Time phrase 'null' is CONFIRMED
2026-01-31 13:11:28,385 - __main__ - INFO - Time explicitly mentioned in conversation: 'null' - using this time directly (no stage-based calculation)
2026-01-31 13:11:28,398 - analysis.schedule_calculator - INFO - Using exact requested time: 11:11:19 (agent commitment, overriding working hours)
2026-01-31 13:11:28,398 - analysis.schedule_calculator - INFO - Callback absolute time 'null' parsed to: 2026-01-31 11:11:19+04:00
2026-01-31 13:11:28,400 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:11:28,400 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:11:28,400 - __main__ - INFO - Using first transcription timestamp date for relative time: 2026-01-31
2026-01-31 13:11:28,401 - __main__ - INFO - Combined target date (2026-01-31) with schedule_calculator time (11:11) = 2026-01-31 11:11:00+04:00
2026-01-31 13:11:29,935 - __main__ - WARNING - Duplicate call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 detected, but retry_count based on lead_id and booking_type
2026-01-31 13:11:29,935 - __main__ - INFO - Existing bookings for lead_id b6e38c17-0861-4546-be1a-9fd4cddb2e40 and booking_type auto_followup: 160
2026-01-31 13:11:29,935 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 159
2026-01-31 13:11:29,935 - __main__ - INFO - retry_count = 160 (max_retry_count + 1)
2026-01-31 13:11:29,935 - __main__ - INFO - parent_booking_id = 04567e73-f80a-40c9-a3b7-8e0e49661451 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 13:11:29,935 - __main__ - INFO - Final retry count for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9: 160
2026-01-31 13:11:29,935 - __main__ - INFO - scheduled_at: 2026-01-31 11:11:00+04:00, buffer_until: 2026-01-31 11:26:00+04:00
2026-01-31 13:11:29,936 - __main__ - DEBUG - JSON file saving disabled for call_log_id=04567e73-f80a-40c9-a3b7-8e0e49661451
2026-01-31 13:11:29,936 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 13:11:29,936 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:11:30,140 - db.storage.leads - DEBUG - Lead b6e38c17-0861-4546-be1a-9fd4cddb2e40 already assigned or not found
2026-01-31 13:11:30,352 - db.storage.lead_bookings - ERROR - Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\db\storage\lead_bookings.py", line 377, in save_booking
    cur.execute(f"""
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.

2026-01-31 13:11:30,353 - __main__ - WARNING - Skipped database save: Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.

2026-01-31 13:11:30,495 - httpcore.connection - DEBUG - close.started
2026-01-31 13:11:30,496 - httpcore.connection - DEBUG - close.complete
2026-01-31 13:12:39,485 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:12:39,511 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:12:39,533 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:12:39,572 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:12:41,633 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:12:41,633 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 13:12:42,063 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 13:12:42,431 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 13:12:42,633 - __main__ - DEBUG - Parsed 11 segments from transcripts
2026-01-31 13:12:42,633 - __main__ - INFO - call_id from transcription: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, fallback to voice_call_logs.id: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, using: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9
2026-01-31 13:12:42,634 - __main__ - INFO - Extracting booking info from conversation (length: 1429 chars)
2026-01-31 13:12:42,634 - __main__ - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 13:12:42,634 - __main__ - INFO - Conversation length: 1429 chars
2026-01-31 13:12:42,634 - __main__ - DEBUG - Calling Gemini API with structured output: temperature=0.1, maxOutputTokens=4096
2026-01-31 13:12:42,636 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 13:12:42,769 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:12:42,772 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2026-01-31 13:12:42,784 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000025042687470>
2026-01-31 13:12:42,785 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000002504279EAD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2026-01-31 13:12:42,806 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002504262CE30>
2026-01-31 13:12:42,806 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 13:12:42,806 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 13:12:42,806 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 13:12:42,808 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 13:12:42,808 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 13:12:44,244 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 07:42:45 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1429'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 13:12:44,244 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:12:44,245 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 13:12:44,245 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 13:12:44,246 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 13:12:44,246 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 13:12:44,247 - analysis.gemini_client - DEBUG - API finish_reason: FinishReason.STOP
2026-01-31 13:12:44,247 - analysis.gemini_client - DEBUG - Raw Gemini response (first 500 chars): {
"booking_type": "auto_followup",
"scheduled_at": "null",
"student_grade": 12,
"call_id": "null",
"has_future_discussion": false
}
2026-01-31 13:12:44,247 - analysis.gemini_client - DEBUG - Response length: 131 chars
2026-01-31 13:12:44,250 - __main__ - DEBUG - Booking extraction structured response received
2026-01-31 13:12:44,250 - __main__ - INFO - Checking for default timing: has_future=False, scheduled_at=null
2026-01-31 13:12:44,250 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': 'null', 'student_grade': 12, 'call_id': 'null'}
2026-01-31 13:12:44,509 - __main__ - WARNING - Booking already exists for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 - this is a duplicate call
2026-01-31 13:12:44,509 - __main__ - INFO - Student grade mentioned in conversation: Grade 12
2026-01-31 13:12:44,510 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:12:44,510 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:12:44,510 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-31 11:11:19+04:00 (GST)
2026-01-31 13:12:44,510 - __main__ - DEBUG - Call started at: 2026-01-31 11:10:53.413538+04:00, using transcription timestamp 2026-01-31 11:11:19+04:00 as reference for scheduling
2026-01-31 13:12:44,510 - __main__ - INFO - Time phrase 'null' is CONFIRMED
2026-01-31 13:12:44,510 - __main__ - INFO - Time explicitly mentioned in conversation: 'null' - using this time directly (no stage-based calculation)
2026-01-31 13:12:44,525 - analysis.schedule_calculator - INFO - Using exact requested time: 11:11:19 (agent commitment, overriding working hours)
2026-01-31 13:12:44,525 - analysis.schedule_calculator - INFO - Callback absolute time 'null' parsed to: 2026-01-31 11:11:19+04:00
2026-01-31 13:12:44,526 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:12:44,526 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:12:44,526 - __main__ - INFO - Using first transcription timestamp date for relative time: 2026-01-31
2026-01-31 13:12:44,526 - __main__ - INFO - Combined target date (2026-01-31) with schedule_calculator time (11:11) = 2026-01-31 11:11:00+04:00
2026-01-31 13:12:45,726 - __main__ - WARNING - Duplicate call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 detected, but retry_count based on lead_id and booking_type
2026-01-31 13:12:45,726 - __main__ - INFO - Existing bookings for lead_id b6e38c17-0861-4546-be1a-9fd4cddb2e40 and booking_type auto_followup: 160
2026-01-31 13:12:45,726 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 159
2026-01-31 13:12:45,726 - __main__ - INFO - retry_count = 160 (max_retry_count + 1)
2026-01-31 13:12:45,726 - __main__ - INFO - parent_booking_id = 04567e73-f80a-40c9-a3b7-8e0e49661451 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 13:12:45,726 - __main__ - INFO - Final retry count for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9: 160
2026-01-31 13:12:45,727 - __main__ - INFO - scheduled_at: 2026-01-31 11:11:00+04:00, buffer_until: 2026-01-31 11:26:00+04:00
2026-01-31 13:12:45,727 - __main__ - DEBUG - JSON file saving disabled for call_log_id=04567e73-f80a-40c9-a3b7-8e0e49661451
2026-01-31 13:12:45,727 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 13:12:45,728 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:12:45,926 - db.storage.leads - DEBUG - Lead b6e38c17-0861-4546-be1a-9fd4cddb2e40 already assigned or not found
2026-01-31 13:12:46,130 - db.storage.lead_bookings - ERROR - Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\db\storage\lead_bookings.py", line 377, in save_booking
    cur.execute(f"""
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.

2026-01-31 13:12:46,131 - __main__ - WARNING - Skipped database save: Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-01-31 11:11:00, auto_followup) already exists.

2026-01-31 13:12:46,283 - httpcore.connection - DEBUG - close.started
2026-01-31 13:12:46,284 - httpcore.connection - DEBUG - close.complete
2026-01-31 13:13:54,608 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:13:54,632 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:13:54,656 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:13:54,677 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:13:56,553 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:13:56,553 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 13:13:56,976 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 13:13:57,351 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 13:13:57,561 - __main__ - DEBUG - Parsed 11 segments from transcripts
2026-01-31 13:13:57,561 - __main__ - INFO - call_id from transcription: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, fallback to voice_call_logs.id: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, using: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9
2026-01-31 13:13:57,561 - __main__ - INFO - Extracting booking info from conversation (length: 1429 chars)
2026-01-31 13:13:57,562 - __main__ - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 13:13:57,562 - __main__ - INFO - Conversation length: 1429 chars
2026-01-31 13:13:57,562 - __main__ - DEBUG - Calling Gemini API with structured output: temperature=0.1, maxOutputTokens=4096
2026-01-31 13:13:57,563 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 13:13:57,671 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:13:57,673 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2026-01-31 13:13:57,696 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000026588B8A9C0>
2026-01-31 13:13:57,697 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000026588CFEAD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2026-01-31 13:13:57,713 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000026588B8AC90>
2026-01-31 13:13:57,715 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 13:13:57,715 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 13:13:57,715 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 13:13:57,715 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 13:13:57,716 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 13:13:59,182 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 07:44:00 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1458'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 13:13:59,183 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:13:59,183 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 13:13:59,183 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 13:13:59,184 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 13:13:59,184 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 13:13:59,184 - analysis.gemini_client - DEBUG - API finish_reason: FinishReason.STOP
2026-01-31 13:13:59,184 - analysis.gemini_client - DEBUG - Raw Gemini response (first 500 chars): {
"booking_type": "auto_followup",
"scheduled_at": "null",
"student_grade": 10,
"call_id": "null",
"has_future_discussion": false
}
2026-01-31 13:13:59,185 - analysis.gemini_client - DEBUG - Response length: 131 chars
2026-01-31 13:13:59,185 - __main__ - DEBUG - Booking extraction structured response received
2026-01-31 13:13:59,185 - __main__ - INFO - No future discussion detected - forcing auto_followup with grade 12 default
2026-01-31 13:13:59,185 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': 'use_default_timing', 'student_grade': 10, 'call_id': None}
2026-01-31 13:13:59,483 - __main__ - WARNING - Booking already exists for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 - this is a duplicate call
2026-01-31 13:13:59,483 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:13:59,483 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:13:59,483 - __main__ - INFO - [use_default_timing] Non-12th grade fallback: scheduled_at set to 2026-01-31 11:11:00+04:00 (same day as first transcript)
2026-01-31 13:13:59,483 - __main__ - INFO - Student grade mentioned in conversation: Grade 10
2026-01-31 13:13:59,483 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:13:59,483 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:13:59,483 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-31 11:11:19+04:00 (GST)
2026-01-31 13:13:59,483 - __main__ - DEBUG - Call started at: 2026-01-31 11:10:53.413538+04:00, using transcription timestamp 2026-01-31 11:11:19+04:00 as reference for scheduling
2026-01-31 13:13:59,487 - __main__ - INFO - Extracted time from conversation using pattern #5 '(?:^|[.\s,\'"])(?:after|in|within)\s+(\d+)(?:\s|\....': 'after 2027 mins'
2026-01-31 13:13:59,487 - __main__ - INFO - Extracted time from conversation text (fallback): 'after 2027 mins'
2026-01-31 13:13:59,487 - __main__ - INFO - Fallback extraction found relative time 'after 2027 mins' - treating as CONFIRMED
2026-01-31 13:13:59,487 - __main__ - INFO - No explicit time from Gemini, attempting final extraction from conversation text...
2026-01-31 13:13:59,487 - __main__ - DEBUG - Conversation text sample (first 500 chars): Agent: Hi there, this is Nithya from Sasya Spaces... um, Dubai. Am I speaking with Pavan?
User: Yes.
User: I'm
Agent: Right, Pavan... so, you'd shown interest in Dubai property recently, right? I just wanted to follow upare you still, like, exploring options?
User: Yeah. I am exploring. Still, I am exploring.
Agent: Okay, good to know. I mean, honestly, since we last spoke, the pipeline has been moving really fast for investors looking at the Golden Visa route.

You were looking above 5 Crore,
2026-01-31 13:13:59,489 - __main__ - INFO - Extracted time from conversation using pattern #5 '(?:^|[.\s,\'"])(?:after|in|within)\s+(\d+)(?:\s|\....': 'after 2027 mins'
2026-01-31 13:13:59,489 - __main__ - INFO - Final extraction successful! Found time: 'after 2027 mins'
2026-01-31 13:13:59,494 - __main__ - INFO - Using last transcription timestamp (reference_time) as base for relative time: 2026-01-31 11:11:19+04:00
2026-01-31 13:13:59,494 - __main__ - INFO - Relative time (same day): 'after 2027 mins' = 2026-01-31 11:11:19+04:00 + 2027 minutes = 2026-02-01 20:58:19+04:00
2026-01-31 13:13:59,495 - __main__ - INFO - Successfully calculated scheduled_at from final extraction: 2026-02-01 20:58:19+04:00
2026-01-31 13:14:00,613 - __main__ - WARNING - Duplicate call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 detected, but retry_count based on lead_id and booking_type
2026-01-31 13:14:00,613 - __main__ - INFO - Existing bookings for lead_id b6e38c17-0861-4546-be1a-9fd4cddb2e40 and booking_type auto_followup: 160
2026-01-31 13:14:00,613 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 159
2026-01-31 13:14:00,613 - __main__ - INFO - retry_count = 160 (max_retry_count + 1)
2026-01-31 13:14:00,613 - __main__ - INFO - parent_booking_id = 04567e73-f80a-40c9-a3b7-8e0e49661451 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 13:14:00,613 - __main__ - INFO - Final retry count for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9: 160
2026-01-31 13:14:00,613 - __main__ - INFO - scheduled_at: 2026-02-01 20:58:19+04:00, buffer_until: 2026-02-01 21:13:19+04:00
2026-01-31 13:14:00,613 - __main__ - DEBUG - JSON file saving disabled for call_log_id=04567e73-f80a-40c9-a3b7-8e0e49661451
2026-01-31 13:14:00,613 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 13:14:00,613 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:14:00,822 - db.storage.leads - DEBUG - Lead b6e38c17-0861-4546-be1a-9fd4cddb2e40 already assigned or not found
2026-01-31 13:14:01,148 - db.storage.lead_bookings - ERROR - Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-02-01 20:58:00, auto_followup) already exists.
Traceback (most recent call last):
  File "D:\vonage\vonage-voice-agent\v2\db\storage\lead_bookings.py", line 377, in save_booking
    cur.execute(f"""
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-02-01 20:58:00, auto_followup) already exists.

2026-01-31 13:14:01,149 - __main__ - WARNING - Skipped database save: Failed to save booking: duplicate key value violates unique constraint "idx_lead_bookings_prevent_rapid_duplicates"
DETAIL:  Key (tenant_id, lead_id, date_trunc('minute'::text, scheduled_at), booking_type)=(926070b5-189b-4682-9279-ea10ca090b84, b6e38c17-0861-4546-be1a-9fd4cddb2e40, 2026-02-01 20:58:00, auto_followup) already exists.

2026-01-31 13:14:01,298 - httpcore.connection - DEBUG - close.started
2026-01-31 13:14:01,298 - httpcore.connection - DEBUG - close.complete
2026-01-31 13:16:06,170 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:16:06,195 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:16:06,219 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 13:16:06,249 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 13:16:08,144 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:16:08,144 - db.connection_pool - DEBUG - Testing database connectivity before creating pool...
2026-01-31 13:16:08,560 - db.connection_pool - DEBUG - Database connectivity verified
2026-01-31 13:16:08,962 - db.connection_pool - INFO - Database connection pool initialized: min=1, max=10, timeout=30s, host=165.22.221.77
2026-01-31 13:16:09,178 - __main__ - DEBUG - Parsed 11 segments from transcripts
2026-01-31 13:16:09,178 - __main__ - INFO - call_id from transcription: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, fallback to voice_call_logs.id: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9, using: 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9
2026-01-31 13:16:09,178 - __main__ - INFO - Extracting booking info from conversation (length: 1429 chars)
2026-01-31 13:16:09,178 - __main__ - INFO - Calling Gemini API for booking extraction with structured output
2026-01-31 13:16:09,178 - __main__ - INFO - Conversation length: 1429 chars
2026-01-31 13:16:09,178 - __main__ - DEBUG - Calling Gemini API with structured output: temperature=0.1, maxOutputTokens=4096
2026-01-31 13:16:09,180 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 13:16:09,286 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 13:16:09,288 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2026-01-31 13:16:09,300 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C77FB8C4A0>
2026-01-31 13:16:09,300 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C7101CEAD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2026-01-31 13:16:09,315 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C7100653A0>
2026-01-31 13:16:09,315 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-31 13:16:09,316 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-31 13:16:09,316 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-31 13:16:09,317 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-31 13:16:09,317 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-31 13:16:10,819 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Sat, 31 Jan 2026 07:46:11 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1492'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2026-01-31 13:16:10,819 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
2026-01-31 13:16:10,819 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-31 13:16:10,820 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-31 13:16:10,820 - httpcore.http11 - DEBUG - response_closed.started
2026-01-31 13:16:10,820 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-31 13:16:10,821 - analysis.gemini_client - DEBUG - API finish_reason: FinishReason.STOP
2026-01-31 13:16:10,821 - analysis.gemini_client - DEBUG - Raw Gemini response (first 500 chars): {
"booking_type": "auto_followup",
"scheduled_at": "null",
"student_grade": 12,
"call_id": "null",
"has_future_discussion": false
}
2026-01-31 13:16:10,821 - analysis.gemini_client - DEBUG - Response length: 131 chars
2026-01-31 13:16:10,823 - __main__ - DEBUG - Booking extraction structured response received
2026-01-31 13:16:10,823 - __main__ - INFO - No future discussion detected - forcing auto_followup with grade 12 default
2026-01-31 13:16:10,823 - __main__ - INFO - Extracted booking info: {'booking_type': 'auto_followup', 'scheduled_at': 'use_default_timing', 'student_grade': 12, 'call_id': None}
2026-01-31 13:16:11,093 - __main__ - WARNING - Booking already exists for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 - this is a duplicate call
2026-01-31 13:16:11,093 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:16:11,093 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:16:11,093 - __main__ - INFO - [use_default_timing] Grade 12 fallback: scheduled_at set to 2026-02-02 11:11:00+04:00 (2 days after first transcript)
2026-01-31 13:16:11,094 - __main__ - INFO - Student grade mentioned in conversation: Grade 12
2026-01-31 13:16:11,094 - __main__ - INFO - Found first timestamp in transcription: 2026-01-31T07:11:19.081505+00:00 -> 2026-01-31 07:11:19.081505+00:00 (UTC)
2026-01-31 13:16:11,094 - __main__ - INFO - Extracted first timestamp from transcriptions: 2026-01-31 07:11:19.081505+00:00 (UTC) -> 2026-01-31 11:11:19.081505+04:00 (GST)
2026-01-31 13:16:11,094 - __main__ - INFO - Future date detected - using first transcription timestamp as reference_time: 2026-01-31 11:11:19+04:00 (GST)
2026-01-31 13:16:11,094 - __main__ - DEBUG - Call started at: 2026-01-31 11:10:53.413538+04:00, using transcription timestamp 2026-01-31 11:11:19+04:00 as reference for scheduling
2026-01-31 13:16:11,098 - __main__ - INFO - Extracted time from conversation using pattern #5 '(?:^|[.\s,\'"])(?:after|in|within)\s+(\d+)(?:\s|\....': 'after 2027 mins'
2026-01-31 13:16:11,098 - __main__ - INFO - Extracted time from conversation text (fallback): 'after 2027 mins'
2026-01-31 13:16:11,098 - __main__ - INFO - Fallback extraction found relative time 'after 2027 mins' - treating as CONFIRMED
2026-01-31 13:16:11,098 - __main__ - INFO - Skipping final extraction because special_handling_mode is active
2026-01-31 13:16:12,410 - __main__ - WARNING - Duplicate call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9 detected, but retry_count based on lead_id and booking_type
2026-01-31 13:16:12,411 - __main__ - INFO - Existing bookings for lead_id b6e38c17-0861-4546-be1a-9fd4cddb2e40 and booking_type auto_followup: 161
2026-01-31 13:16:12,411 - __main__ - INFO - Maximum retry_count for this lead_id and booking_type: 160
2026-01-31 13:16:12,411 - __main__ - INFO - retry_count = 161 (max_retry_count + 1)
2026-01-31 13:16:12,411 - __main__ - INFO - parent_booking_id = 04567e73-f80a-40c9-a3b7-8e0e49661451 (call_id from metadata of original booking where parent_booking_id IS NULL)
2026-01-31 13:16:12,411 - __main__ - INFO - Final retry count for call_id 9399cef1-5023-4eb1-9c97-0bdd2a4f43c9: 161
2026-01-31 13:16:12,411 - __main__ - INFO - scheduled_at: 2026-02-02 11:11:00+04:00, buffer_until: 2026-02-02 11:26:00+04:00
2026-01-31 13:16:12,412 - __main__ - DEBUG - JSON file saving disabled for call_log_id=04567e73-f80a-40c9-a3b7-8e0e49661451
2026-01-31 13:16:12,412 - __main__ - INFO - Saved booking to JSON: None
2026-01-31 13:16:12,412 - db.db_config - DEBUG - Using PRODUCTION database: 165.22.221.77:5432/salesmaya_agent
2026-01-31 13:16:12,644 - db.storage.leads - DEBUG - Lead b6e38c17-0861-4546-be1a-9fd4cddb2e40 already assigned or not found
2026-01-31 13:16:12,898 - __main__ - INFO - Saved booking to database: 46909c3e-8d33-4c14-966c-0c8086cf4f06
2026-01-31 13:16:13,070 - httpcore.connection - DEBUG - close.started
2026-01-31 13:16:13,071 - httpcore.connection - DEBUG - close.complete
2026-01-31 23:12:31,394 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 23:12:31,453 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 23:12:31,515 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 23:12:31,569 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 23:13:09,204 - db.config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 23:13:09,237 - db.pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 23:13:09,304 - db.connection_pool - INFO - Database connection pooling ENABLED: min=1, max=10, timeout=30s
2026-01-31 23:13:09,356 - db.db_config - INFO - Database mode: PRODUCTION (using DB_* environment variables)
2026-01-31 23:13:12,719 - __main__ - INFO - Testing usage extraction from Gemini Client...
2026-01-31 23:13:12,721 - __main__ - INFO - 
1. Testing generate_text(include_usage=True)...
2026-01-31 23:13:12,722 - google_genai._api_client - WARNING - Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.
2026-01-31 23:13:13,061 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-31 23:13:15,299 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent "HTTP/1.1 200 OK"
